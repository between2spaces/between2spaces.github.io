<!doctype html>
<html>
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1" />
		<link rel="icon" href="data:;base64,iVBORw0KGgo=">
		<title>soba</title>
		<style>
			html, body { margin: 0; padding: 0; font-family: sans-serif; font-size: 110%; width: 100%; height: 100%; }
			* { box-sizing: border-box; }
		</style>
		<script src="../0.1.0/lib/pixi.js"></script>
	</head>
	<body>
		<script>
function src_Vec3__Vec3(a){return{x:a&&a.x?a.x:0,y:a&&a.y?a.y:0,z:a&&a.z?a.z:0}}src_Vec3__Vec3.equals=function(a,b){return b.x===a.x&&b.y===a.y&&b.z===a.z};src_Vec3__Vec3.add=function(a,b){a.x+=b.x;a.y+=b.y;a.z+=b.z;return a};src_Vec3__Vec3.addVectors=function(a,b){return src_Vec3__Vec3.add(src_Vec3__Vec3(a),b)};src_Vec3__Vec3.addScalar=function(a,b){a.x+=b;a.y+=b;a.z+=b;return a};src_Vec3__Vec3.subtract=function(a,b){a.x-=b.x;a.y-=b.y;a.z-=b.z;return a};
src_Vec3__Vec3.subtractVectors=function(a,b){return src_Vec3__Vec3.subtract(src_Vec3__Vec3(a),b)};src_Vec3__Vec3.multiply=function(a,b){a.x*=b.x;a.y*=b.y;a.z*=b.z;return a};src_Vec3__Vec3.multiplyScalar=function(a,b){a.x*=b;a.y*=b;a.z*=b;return a};src_Vec3__Vec3.divide=function(a,b){a.x/=b.x;a.y/=b.y;a.z/=b.z;return a};src_Vec3__Vec3.divideScalar=function(a,b){if(0!==b){var c=1/b;a.x*=c;a.y*=c;a.z*=c}else a.x=0,a.y=0,a.z=0;return a};
src_Vec3__Vec3.clamp=function(a,b,c){a.x<b.x?a.x=b.x:a.x>c.x&&(a.x=c.x);a.y<b.y?a.y=b.y:a.y>c.y&&(a.y=c.y);a.z<b.z?a.z=b.z:a.z>c.z&&(a.z=c.z);return a};src_Vec3__Vec3.floor=function(a){a.x=Math.floor(a.x);a.y=Math.floor(a.y);a.z=Math.floor(a.z);return a};src_Vec3__Vec3.ceil=function(a){a.x=Math.ceil(a.x);a.y=Math.ceil(a.y);a.z=Math.ceil(a.z);return a};src_Vec3__Vec3.round=function(a){a.x=Math.round(a.x);a.y=Math.round(a.y);a.z=Math.round(a.z);return a};
src_Vec3__Vec3.roundToZero=function(a){a.x=0>a.x?Math.ceil(a.x):Math.floor(a.x);a.y=0>a.y?Math.ceil(a.y):Math.floor(a.y);a.z=0>a.z?Math.ceil(a.z):Math.floor(a.z);return a};src_Vec3__Vec3.negate=function(a){a.x=-a.x;a.y=-a.y;a.z=-a.z;return a};src_Vec3__Vec3.dot=function(a,b){return a.x*b.x+a.y*b.y+a.z*b.z};src_Vec3__Vec3.lenSq=function(a){return a.x*a.x+a.y*a.y+a.z*a.z};src_Vec3__Vec3.len=function(a){return Math.sqrt(src_Vec3__Vec3.lenSq(a))};
src_Vec3__Vec3.normalise=function(a){return src_Vec3__Vec3.divideScalar(a,src_Vec3__Vec3.len(a))};src_Vec3__Vec3.distanceToSq=function(a,b){var c=a.x-b.x,d=a.y-b.y,e=a.z-b.z;return c*c+d*d+e*e};src_Vec3__Vec3.distanceTo=function(a,b){return Math.sqrt(src_Vec3__Vec3.distanceToSq(a,b))};src_Vec3__Vec3.setLen=function(a,b){var c=src_Vec3__Vec3.len(a);0!==c&&b!==c&&src_Vec3__Vec3.multiplyScalar(a,b/c);return a};src_Vec3__Vec3.lerp=function(a,b,c){a.x+=(b.x-a.x)*c;a.y+=(b.y-a.y)*c;a.z+=(b.z-a.z)*c;return a};
function src_vec3__Vec3(a){return{x:a&&a.x?a.x:0,y:a&&a.y?a.y:0,z:a&&a.z?a.z:0}}src_vec3__Vec3.equals=function(a,b){return b.x===a.x&&b.y===a.y&&b.z===a.z};src_vec3__Vec3.add=function(a,b){a.x+=b.x;a.y+=b.y;a.z+=b.z;return a};src_vec3__Vec3.addVectors=function(a,b){return src_vec3__Vec3.add(src_vec3__Vec3(a),b)};src_vec3__Vec3.addScalar=function(a,b){a.x+=b;a.y+=b;a.z+=b;return a};src_vec3__Vec3.subtract=function(a,b){a.x-=b.x;a.y-=b.y;a.z-=b.z;return a};
src_vec3__Vec3.subtractVectors=function(a,b){return src_vec3__Vec3.subtract(src_vec3__Vec3(a),b)};src_vec3__Vec3.multiply=function(a,b){a.x*=b.x;a.y*=b.y;a.z*=b.z;return a};src_vec3__Vec3.multiplyScalar=function(a,b){a.x*=b;a.y*=b;a.z*=b;return a};src_vec3__Vec3.divide=function(a,b){a.x/=b.x;a.y/=b.y;a.z/=b.z;return a};src_vec3__Vec3.divideScalar=function(a,b){if(0!==b){var c=1/b;a.x*=c;a.y*=c;a.z*=c}else a.x=0,a.y=0,a.z=0;return a};
src_vec3__Vec3.clamp=function(a,b,c){a.x<b.x?a.x=b.x:a.x>c.x&&(a.x=c.x);a.y<b.y?a.y=b.y:a.y>c.y&&(a.y=c.y);a.z<b.z?a.z=b.z:a.z>c.z&&(a.z=c.z);return a};src_vec3__Vec3.floor=function(a){a.x=Math.floor(a.x);a.y=Math.floor(a.y);a.z=Math.floor(a.z);return a};src_vec3__Vec3.ceil=function(a){a.x=Math.ceil(a.x);a.y=Math.ceil(a.y);a.z=Math.ceil(a.z);return a};src_vec3__Vec3.round=function(a){a.x=Math.round(a.x);a.y=Math.round(a.y);a.z=Math.round(a.z);return a};
src_vec3__Vec3.roundToZero=function(a){a.x=0>a.x?Math.ceil(a.x):Math.floor(a.x);a.y=0>a.y?Math.ceil(a.y):Math.floor(a.y);a.z=0>a.z?Math.ceil(a.z):Math.floor(a.z);return a};src_vec3__Vec3.negate=function(a){a.x=-a.x;a.y=-a.y;a.z=-a.z;return a};src_vec3__Vec3.dot=function(a,b){return a.x*b.x+a.y*b.y+a.z*b.z};src_vec3__Vec3.lenSq=function(a){return a.x*a.x+a.y*a.y+a.z*a.z};src_vec3__Vec3.len=function(a){return Math.sqrt(src_vec3__Vec3.lenSq(a))};
src_vec3__Vec3.normalise=function(a){return src_vec3__Vec3.divideScalar(a,src_vec3__Vec3.len(a))};src_vec3__Vec3.distanceToSq=function(a,b){var c=a.x-b.x,d=a.y-b.y,e=a.z-b.z;return c*c+d*d+e*e};src_vec3__Vec3.distanceTo=function(a,b){return Math.sqrt(src_vec3__Vec3.distanceToSq(a,b))};src_vec3__Vec3.setLen=function(a,b){var c=src_vec3__Vec3.len(a);0!==c&&b!==c&&src_vec3__Vec3.multiplyScalar(a,b/c);return a};src_vec3__Vec3.lerp=function(a,b,c){a.x+=(b.x-a.x)*c;a.y+=(b.y-a.y)*c;a.z+=(b.z-a.z)*c;return a};
function Action(a){return{type:a&&a.type?a.type:"default",actions:[]}}Action.update=function(a){return Action[a.type].update(a)};Action.Destination=function(a){var b=Action({type:"Destination"});b.entity=a&&a.entity?a.entity:null;b.offset=a&&a.offset?src_vec3__Vec3(a.offset):src_vec3__Vec3();b.last_update=a&&a.last_update?a.last_update:game.timestamp;return b};
Action.Destination.update=function(a){var b=a.entity;if(0===b.movement_speed)return!0;var c=b.movement_speed/1E3*(game.timestamp-a.last_update);a.last_update=game.timestamp;if(0>=c)return!1;var d=src_vec3__Vec3.subtractVectors(a.offset,b.offset);src_vec3__Vec3.lenSq(d)<c*c?d=a.offset:(src_vec3__Vec3.normalise(d),src_vec3__Vec3.multiplyScalar(d,c),src_vec3__Vec3.add(d,b.offset));if(d===a.offset)return b.offset.x=a.offset.x,b.offset.y=a.offset.y,!0;b.offset.x=d.x;b.offset.y=d.y;return!1};
var __entity__=__entity__||{};__entity__.byId=__entity__.byId||{};
function Entity(a){var b={id:0,name:a&&a.name?a.name:"",offset:a&&a.offset?src_Vec3__Vec3(a.offset):src_Vec3__Vec3(),rotation:a&&a.rotation?a.rotation:0,width:a&&a.width?a.width:.5,height:a&&a.height?a.height:.5,movement_speed:a&&a.movement_speed?a.movement_speed:1,parent:null,children:[],actions:[],model:a&&a.model?a.model:"unknown",sprite:null};b.sprite=PIXI.Sprite.fromImage("models/"+b.model+"/sprite.png");b.sprite.anchor.x=.5;for(b.sprite.anchor.y=.9;!b.id||__entity__.byId.hasOwnProperty(b.id);)b.id=
~~(200+32*Math.random())<<16|~~(200+32*Math.random())<<8|~~(200+32*Math.random());__entity__.byId[b.id]=b;a&&a.parent&&Entity.addChild(a.parent,b);if(a&&a.children&&a.children.length)for(var c=0;c<a.children.length;++c)Entity(a.children[c]);Entity.update(b);return b}Entity.byId=__entity__.byId;
Entity.addChild=function(a,b){if(b.parent!==a){b.parent&&Entity.removeChild(b.parent,b);for(var c=-1,d=0;d<a.children.length;++d)if(a.children[d].offset.y>b.offset.y){c=d;break}-1<c?(a.children.splice(c,0,b),a.sprite.addChildAt(b.sprite,c)):(a.children.push(b),a.sprite.addChild(b.sprite));b.parent=a}};Entity.removeChild=function(a){var b=a.parent.children.indexOf(a);-1<b&&a.parent.children.splice(b,1);parent.sprite.removeChild(a.sprite);a.parent=null};
Entity.sortChild=function(a){if(a.parent){var b=a.parent.children.indexOf(a),c=a.offset.y;if(0<b&&a.parent.children[b-1].offset.y>c)for(a.parent.children.splice(b,1);0<b&&a.parent.children[b-1].offset.y>c;)--b;else if(b<a.parent.children.length-1&&a.parent.children[b+1].offset.y<c){a.parent.children.splice(b,1);do++b;while(b<a.parent.children.length-1&&a.parent.children[b+1].offset.y<c)}else return;a.parent.children.splice(b,0,a);a.parent.sprite.setChildIndex(a.sprite,b)}};
Entity.update=function(a){for(var b=0;b<a.actions.length;++b)Action.update(a.actions[b])&&(a.actions.splice(b,1),--b);Entity.sortChild(a);a.sprite.position.x=~~(a.offset.x*game.PIXELS_PER_METRE);a.sprite.position.y=~~(a.offset.y*game.PIXELS_PER_METRE);a.sprite.rotation=a.rotation;a!==game.world&&(b=1+(game.world?a.offset.y-game.world.offset.y:-a.offset.y)*game.VERTICAL_PARRALAX,a.sprite.width=~~(a.width*b*game.PIXELS_PER_METRE),a.sprite.height=~~(a.height*b*game.PIXELS_PER_METRE))};
Entity.move=function(a,b){for(var c=0;c<a.actions.length;++c){var d=a.actions[c];if("Destination"===d.type){d.offset.x=b.x;d.offset.y=b.y;return}}a.actions.push(Action.Destination({entity:a,offset:b}))};PIXI.utils._saidHello=!0;var game=game||{};game.RESOLUTION_WIDTH=800;game.RESOLUTION_HEIGHT=~~(game.RESOLUTION_WIDTH/(innerWidth/innerHeight));game.PIXELS_PER_METRE=game.RESOLUTION_WIDTH/20;game.VERTICAL_PARRALAX=.015;
game.debug=function(a){var b=new Date;console.log("["+("00"+b.getHours()).slice(-2)+":"+("00"+b.getMinutes()).slice(-2)+":"+("00"+b.getSeconds()).slice(-2)+"] "+a)};game.world||(game.world=Entity({model:"blank",movement_speed:2}),game.world.sprite=new PIXI.Container);var __game__=__game__||{};__game__.stage=__game__.stage||new PIXI.Container;__game__.stage.position.x=~~(.5*game.RESOLUTION_WIDTH);__game__.stage.position.y=~~(.5*game.RESOLUTION_HEIGHT);__game__.stage.addChild(game.world.sprite);
__game__.orderedEvents=__game__.orderedEvents||[];game.Event=function(a){a={timestamp:a&&a.timestamp?a.timestamp:game.timestamp,on_event:a&&a.on_event?a.on_event:function(){}};for(var b=__game__.orderedEvents.length-1;-1<b&&__game__.orderedEvents[b].timestamp>a.timestamp;)--b;__game__.orderedEvents.splice(b+1,0,a);return a};game.InputState=function(a){return{isDown:a&&"undefined"!==typeof a.isDown?a.isDown:!1,lastDown:a&&"undefined"!==typeof a.lastDown?a.lastDown:-99999}};
__game__.inputStatesByCode=__game__.inputStatesByCode||{};game.input=function(a){__game__.inputStatesByCode.hasOwnProperty(a)||(__game__.inputStatesByCode[a]=game.InputState({isDown:!1,lastDown:-99999}));return __game__.inputStatesByCode[a]};game.KEY_ENTER=13;game.KEY_ESC=27;game.KEY_SPACE=32;game.KEY_LEFT=37;game.KEY_UP=38;game.KEY_RIGHT=39;game.KEY_DOWN=40;game.MOUSE_LBUTTON=0;game.MOUSE_MBUTTON=1;game.MOUSE_RBUTTON=2;game.MOUSE_OFFSET=-1;
game.read=function(a){(a=localStorage.getItem(a))&&(a=JSON.parse(a));return a};game.memory=game.memory||game.read("Memory")||{};game.write=function(a,b){return localStorage.setItem(a,JSON.stringify(b))};game.timestamp=game.timestamp||0;game.elapsed=game.elapsed||0;game.update=game.update||function(){};
__game__.update=function(a){requestAnimationFrame(__game__.update);game.elapsed=a-game.timestamp;game.timestamp=a;for(a=__game__.orderedEvents;a.length&&a[a.length-1].timestamp<=game.timestamp;){var b=a.pop();b.on_event(b);if(b.timestamp>game.timestamp){for(var c=a.length-1;-1<c&&a[c].timestamp<b.timestamp;)--c;a.splice(c+1,0,b)}}game.update();for(var d in Entity.byId)d=Entity.byId[d],Entity.update(d);game.world.sprite.position.x=-game.world.sprite.position.x;game.world.sprite.position.y=-game.world.sprite.position.y;
__game__.renderer.render(__game__.stage)};__game__.keyDown=function(a){__game__.inputStatesByCode.hasOwnProperty(a.keyCode)?__game__.inputStatesByCode[a.keyCode].isDown=!0:__game__.inputStatesByCode[a.keyCode]=game.InputState({isDown:!0})};__game__.keyUp=function(a){__game__.inputStatesByCode.hasOwnProperty(a.keyCode)?(__game__.inputStatesByCode[a.keyCode].isDown=!1,__game__.inputStatesByCode[a.keyCode].lastDown=game.timestamp):__game__.inputStatesByCode[a.keyCode]=game.InputState({lastDown:game.timestamp})};
__game__.mouseMove=function(a){var b=__game__.inputStatesByCode[game.MOUSE_OFFSET];b.x=game.world.offset.x+(a.pageX/innerWidth-.5)*game.RESOLUTION_WIDTH/game.PIXELS_PER_METRE;b.y=game.world.offset.y+(a.pageY/innerHeight-.5)*game.RESOLUTION_HEIGHT/game.PIXELS_PER_METRE};__game__.contextMenu=function(a){a.preventDefault()};__game__.mouseDown=function(a){a.preventDefault();__game__.inputStatesByCode[a.button].isDown=!0};
__game__.mouseUp=function(a){a.preventDefault();__game__.inputStatesByCode[a.button].lastDown=game.timestamp;__game__.inputStatesByCode[a.button].isDown=!1};__game__.resize=function(){game.RESOLUTION_HEIGHT=~~(game.RESOLUTION_WIDTH/(innerWidth/innerHeight));__game__.renderer.resize(game.RESOLUTION_WIDTH,game.RESOLUTION_HEIGHT);__game__.stage.position.x=~~(.5*game.RESOLUTION_WIDTH);__game__.stage.position.y=~~(.5*game.RESOLUTION_HEIGHT)};
__game__.throttledListener=function(a,b){(function(c){window.addEventListener(a,function(a){c||(b(a),c=setTimeout(function(){c=null},66))},!1)})()};
__game__.initialised||(document.body.style.overflow="hidden",document.body.style.margin=document.body.style.padding="0",__game__.inputStatesByCode[game.MOUSE_OFFSET]=src_Vec3__Vec3(),__game__.inputStatesByCode[game.MOUSE_LBUTTON]=game.InputState(),__game__.inputStatesByCode[game.MOUSE_MBUTTON]=game.InputState(),__game__.inputStatesByCode[game.MOUSE_RBUTTON]=game.InputState(),__game__.throttledListener("keydown",__game__.keyDown),__game__.throttledListener("keyup",__game__.keyUp),__game__.throttledListener("mousemove",
__game__.mouseMove),__game__.throttledListener("contextmenu",__game__.contextMenu),__game__.throttledListener("mousedown",__game__.mouseDown),__game__.throttledListener("mouseup",__game__.mouseUp),__game__.throttledListener("resize",__game__.resize),addEventListener("beforeunload",function(){game.write("Memory",game.memory)},!1),__game__.renderer=new PIXI.WebGLRenderer(game.RESOLUTION_WIDTH,game.RESOLUTION_HEIGHT,{transparent:!0}),__game__.renderer.view.style.width="100%",__game__.renderer.view.style.height=
"100%",document.body.appendChild(__game__.renderer.view),requestAnimationFrame(function(a){__game__.update(a)}),"localhost"===location.hostname&&setInterval(function(){var a=new XMLHttpRequest;a.open("GET","/liveupdate");a.onload=function(a){if(200===this.status){a=JSON.parse(this.response);0<a.length&&game.debug("liveupdate");for(var c in a){var d=document.body,e=document.createElement("script");e.src=a[c];var f=document.evaluate('//script[ @src="'+e.src+'" ]',document,null,XPathResult.ANY_TYPE).iterateNext();
f&&(d=f.parentNode,d.removeChild(f));d.appendChild(e)}}};a.send()},2E3),__game__.initialised=!0,game.debug("initialised"));var __index__=__index__||{};__index__.rightButtonLastDown=__index__.rightButtonLastDown||-99999;__index__.HER_MOVE_DEADZONE=.15;
game.update=function(){var a=game.input(game.MOUSE_LBUTTON),b=game.input(game.MOUSE_RBUTTON);if(a.isDown||b.isDown||b.lastDown>__index__.rightButtonLastDown)__index__.rightButtonLastDown=game.timestamp,a=game.input(game.MOUSE_OFFSET),src_Vec3__Vec3.distanceToSq(__index__.her.offset,a)>__index__.HER_MOVE_DEADZONE&&(Entity.move(__index__.her,a),Entity.move(game.world,a));Entity.update(__index__.her)};
if(!__index__.trees){__index__.trees=[{x:-7,y:-4,width:3,height:4},{x:-2,y:-5,width:6,height:5},{x:-9,y:-2,width:4,height:5},{x:-8,y:0,width:2,height:4},{x:-4,y:-6,width:4,height:5},{x:1,y:-5.5,width:3,height:5},{x:3,y:-5,width:3,height:5},{x:8,y:-3,width:3,height:5},{x:7,y:0,width:3,height:5},{x:9,y:1,width:3,height:5},{x:2,y:4,width:3,height:5},{x:-1,y:6,width:3,height:5},{x:-3,y:5,width:1,height:2}];for(var index=0;index<__index__.trees.length;++index){var tree=__index__.trees[index];Entity.addChild(game.world,
Entity({name:"tree",offset:src_Vec3__Vec3({x:tree.x,y:tree.y}),width:tree.width,height:tree.height,model:"tree"}))}__index__.grasses=[{x:-6,y:-2,width:2,height:1},{x:-8,y:.3,width:3,height:1.5},{x:-6,y:-9,width:2,height:1},{x:.5,y:-4.5,width:2.5,height:2},{x:0,y:4,width:2,height:1},{x:8,y:2,width:2.5,height:1.2},{x:-4,y:6,width:2.5,height:1.2}];for(index=0;index<__index__.grasses.length;++index){var grass=__index__.grasses[index];Entity.addChild(game.world,Entity({name:"grass",offset:src_Vec3__Vec3({x:grass.x,
y:grass.y}),width:grass.width,height:grass.height,model:"grass"}))}}__index__.her=__index__.her||Entity({name:"x",offset:src_Vec3__Vec3({x:0,y:0}),width:1.2,height:1.8,movement_speed:3,model:"troubadour",parent:game.world});
		</script>
	</body>
</html>