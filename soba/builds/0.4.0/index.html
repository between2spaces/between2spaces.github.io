<!doctype html>
<html>
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1" />
		<link rel="icon" href="data:;base64,iVBORw0KGgo=">
		<title>soba</title>
		<style>
			html, body { margin: 0; padding: 0; font-family: sans-serif; font-size: 110%; width: 100%; height: 100%; }
			* { box-sizing: border-box; }
		</style>
		<script src="../0.1.0/lib/pixi.js"></script>
	</head>
	<body>
		<script>
function src_Vec3__Vec3(a){return{x:a&&a.x?a.x:0,y:a&&a.y?a.y:0,z:a&&a.z?a.z:0}}src_Vec3__Vec3.equals=function(a,b){return b.x===a.x&&b.y===a.y&&b.z===a.z};src_Vec3__Vec3.add=function(a,b){a.x+=b.x;a.y+=b.y;a.z+=b.z;return a};src_Vec3__Vec3.addVectors=function(a,b){return src_Vec3__Vec3.add(src_Vec3__Vec3(a),b)};src_Vec3__Vec3.addScalar=function(a,b){a.x+=b;a.y+=b;a.z+=b;return a};src_Vec3__Vec3.subtract=function(a,b){a.x-=b.x;a.y-=b.y;a.z-=b.z;return a};
src_Vec3__Vec3.subtractVectors=function(a,b){return src_Vec3__Vec3.subtract(src_Vec3__Vec3(a),b)};src_Vec3__Vec3.multiply=function(a,b){a.x*=b.x;a.y*=b.y;a.z*=b.z;return a};src_Vec3__Vec3.multiplyScalar=function(a,b){a.x*=b;a.y*=b;a.z*=b;return a};src_Vec3__Vec3.divide=function(a,b){a.x/=b.x;a.y/=b.y;a.z/=b.z;return a};src_Vec3__Vec3.divideScalar=function(a,b){if(0!==b){var c=1/b;a.x*=c;a.y*=c;a.z*=c}else a.x=0,a.y=0,a.z=0;return a};
src_Vec3__Vec3.clamp=function(a,b,c){a.x<b.x?a.x=b.x:a.x>c.x&&(a.x=c.x);a.y<b.y?a.y=b.y:a.y>c.y&&(a.y=c.y);a.z<b.z?a.z=b.z:a.z>c.z&&(a.z=c.z);return a};src_Vec3__Vec3.floor=function(a){a.x=Math.floor(a.x);a.y=Math.floor(a.y);a.z=Math.floor(a.z);return a};src_Vec3__Vec3.ceil=function(a){a.x=Math.ceil(a.x);a.y=Math.ceil(a.y);a.z=Math.ceil(a.z);return a};src_Vec3__Vec3.round=function(a){a.x=Math.round(a.x);a.y=Math.round(a.y);a.z=Math.round(a.z);return a};
src_Vec3__Vec3.roundToZero=function(a){a.x=0>a.x?Math.ceil(a.x):Math.floor(a.x);a.y=0>a.y?Math.ceil(a.y):Math.floor(a.y);a.z=0>a.z?Math.ceil(a.z):Math.floor(a.z);return a};src_Vec3__Vec3.negate=function(a){a.x=-a.x;a.y=-a.y;a.z=-a.z;return a};src_Vec3__Vec3.dot=function(a,b){return a.x*b.x+a.y*b.y+a.z*b.z};src_Vec3__Vec3.lenSq=function(a){return a.x*a.x+a.y*a.y+a.z*a.z};src_Vec3__Vec3.len=function(a){return Math.sqrt(src_Vec3__Vec3.lenSq(a))};
src_Vec3__Vec3.normalise=function(a){return src_Vec3__Vec3.divideScalar(a,src_Vec3__Vec3.len(a))};src_Vec3__Vec3.distanceToSq=function(a,b){var c=a.x-b.x,d=a.y-b.y,e=a.z-b.z;return c*c+d*d+e*e};src_Vec3__Vec3.distanceTo=function(a,b){return Math.sqrt(src_Vec3__Vec3.distanceToSq(a,b))};src_Vec3__Vec3.setLen=function(a,b){var c=src_Vec3__Vec3.len(a);0!==c&&b!==c&&src_Vec3__Vec3.multiplyScalar(a,b/c);return a};src_Vec3__Vec3.lerp=function(a,b,c){a.x+=(b.x-a.x)*c;a.y+=(b.y-a.y)*c;a.z+=(b.z-a.z)*c;return a};
function src_vec3__Vec3(a){return{x:a&&a.x?a.x:0,y:a&&a.y?a.y:0,z:a&&a.z?a.z:0}}src_vec3__Vec3.equals=function(a,b){return b.x===a.x&&b.y===a.y&&b.z===a.z};src_vec3__Vec3.add=function(a,b){a.x+=b.x;a.y+=b.y;a.z+=b.z;return a};src_vec3__Vec3.addVectors=function(a,b){return src_vec3__Vec3.add(src_vec3__Vec3(a),b)};src_vec3__Vec3.addScalar=function(a,b){a.x+=b;a.y+=b;a.z+=b;return a};src_vec3__Vec3.subtract=function(a,b){a.x-=b.x;a.y-=b.y;a.z-=b.z;return a};
src_vec3__Vec3.subtractVectors=function(a,b){return src_vec3__Vec3.subtract(src_vec3__Vec3(a),b)};src_vec3__Vec3.multiply=function(a,b){a.x*=b.x;a.y*=b.y;a.z*=b.z;return a};src_vec3__Vec3.multiplyScalar=function(a,b){a.x*=b;a.y*=b;a.z*=b;return a};src_vec3__Vec3.divide=function(a,b){a.x/=b.x;a.y/=b.y;a.z/=b.z;return a};src_vec3__Vec3.divideScalar=function(a,b){if(0!==b){var c=1/b;a.x*=c;a.y*=c;a.z*=c}else a.x=0,a.y=0,a.z=0;return a};
src_vec3__Vec3.clamp=function(a,b,c){a.x<b.x?a.x=b.x:a.x>c.x&&(a.x=c.x);a.y<b.y?a.y=b.y:a.y>c.y&&(a.y=c.y);a.z<b.z?a.z=b.z:a.z>c.z&&(a.z=c.z);return a};src_vec3__Vec3.floor=function(a){a.x=Math.floor(a.x);a.y=Math.floor(a.y);a.z=Math.floor(a.z);return a};src_vec3__Vec3.ceil=function(a){a.x=Math.ceil(a.x);a.y=Math.ceil(a.y);a.z=Math.ceil(a.z);return a};src_vec3__Vec3.round=function(a){a.x=Math.round(a.x);a.y=Math.round(a.y);a.z=Math.round(a.z);return a};
src_vec3__Vec3.roundToZero=function(a){a.x=0>a.x?Math.ceil(a.x):Math.floor(a.x);a.y=0>a.y?Math.ceil(a.y):Math.floor(a.y);a.z=0>a.z?Math.ceil(a.z):Math.floor(a.z);return a};src_vec3__Vec3.negate=function(a){a.x=-a.x;a.y=-a.y;a.z=-a.z;return a};src_vec3__Vec3.dot=function(a,b){return a.x*b.x+a.y*b.y+a.z*b.z};src_vec3__Vec3.lenSq=function(a){return a.x*a.x+a.y*a.y+a.z*a.z};src_vec3__Vec3.len=function(a){return Math.sqrt(src_vec3__Vec3.lenSq(a))};
src_vec3__Vec3.normalise=function(a){return src_vec3__Vec3.divideScalar(a,src_vec3__Vec3.len(a))};src_vec3__Vec3.distanceToSq=function(a,b){var c=a.x-b.x,d=a.y-b.y,e=a.z-b.z;return c*c+d*d+e*e};src_vec3__Vec3.distanceTo=function(a,b){return Math.sqrt(src_vec3__Vec3.distanceToSq(a,b))};src_vec3__Vec3.setLen=function(a,b){var c=src_vec3__Vec3.len(a);0!==c&&b!==c&&src_vec3__Vec3.multiplyScalar(a,b/c);return a};src_vec3__Vec3.lerp=function(a,b,c){a.x+=(b.x-a.x)*c;a.y+=(b.y-a.y)*c;a.z+=(b.z-a.z)*c;return a};
var path=path||{},__path__=__path__||{};__path__.GRID_SIZE=250;__path__.CELLS_PER_METRE=4;__path__.LINE_OF_SIGHT_DELTAS=.1;__path__.DEBUGVIEW_UPDATE_MS=333;__path__.MAX_SEARCH_LENGTH=100;__path__.nextDebugViewUpdate=__path__.nextDebugViewUpdate||0;
__path__.GridNode=function(a,b){return{x:a,y:b,offset:src_vec3__Vec3({x:(a-__path__.centre)/__path__.CELLS_PER_METRE,y:(b-__path__.centre)/__path__.CELLS_PER_METRE}),entities:[],weight:1,f:0,g:0,h:0,visited:!1,closed:!1,parent:null,debugPath:!1,north:null,northeast:null,east:null,southeast:null,south:null,southwest:null,west:null,northwest:null,neighbours:[]}};__path__.grid=__path__.grid||[];__path__.entityNodes=__path__.entityNodes||{};__path__.dirtyNodes=__path__.dirtyNodes||[];
__path__.centre=__path__.centre||~~(.5*__path__.GRID_SIZE);__path__.offset=__path__.offset||src_vec3__Vec3();__path__.collisionBox=__path__.collisionBox||src_vec3__Vec3();__path__.min=__path__.min||src_vec3__Vec3();__path__.max=__path__.max||src_vec3__Vec3();
if(!__path__.grid.length){for(var path__y=0;path__y<__path__.GRID_SIZE;++path__y){__path__.grid[path__y]=[];for(var path__x=0;path__x<__path__.GRID_SIZE;++path__x)__path__.grid[path__y][path__x]=__path__.GridNode(path__x,path__y)}for(path__y=0;path__y<__path__.GRID_SIZE;++path__y)for(path__x=0;path__x<__path__.GRID_SIZE;++path__x){var node=__path__.grid[path__y][path__x];node.north=0<path__y?__path__.grid[path__y-1][path__x]:null;node.northeast=0<path__y&&path__x<__path__.GRID_SIZE-1?__path__.grid[path__y-
1][path__x+1]:null;node.east=path__x<__path__.GRID_SIZE-1?__path__.grid[path__y][path__x+1]:null;node.southeast=path__x<__path__.GRID_SIZE-1&&path__y<__path__.GRID_SIZE-1?__path__.grid[path__y+1][path__x+1]:null;node.south=path__y<__path__.GRID_SIZE-1?__path__.grid[path__y+1][path__x]:null;node.southwest=0<path__x&&path__y<__path__.GRID_SIZE-1?__path__.grid[path__y+1][path__x-1]:null;node.west=0<path__x?__path__.grid[path__y][path__x-1]:null;node.northwest=0<path__x&&0<path__y?__path__.grid[path__y-
1][path__x-1]:null;node.neighbours=[];node.north&&node.neighbours.push(node.north);node.east&&node.neighbours.push(node.east);node.south&&node.neighbours.push(node.south);node.west&&node.neighbours.push(node.west)}}
path.initialise=function(){__path__.canvas=document.createElement("canvas");__path__.canvas.width=__path__.GRID_SIZE;__path__.canvas.height=__path__.GRID_SIZE;__path__.canvas.style.imageRendering="pixelated";__path__.sprite=new PIXI.Sprite(PIXI.Texture.fromCanvas(__path__.canvas));__path__.context=__path__.canvas.getContext("2d",{antialias:!1,depth:!1});__path__.CLEAR_COLOUR=__path__.context.createImageData(1,1);var a=__path__.CLEAR_COLOUR.data;a[3]=0;__path__.LIMIT_COLOUR=__path__.context.createImageData(1,
1);a=__path__.LIMIT_COLOUR.data;a[0]=a[2]=255;a[3]=200;__path__.COLLISION_COLOUR=__path__.context.createImageData(1,1);a=__path__.COLLISION_COLOUR.data;a[3]=50;__path__.PATH_COLOUR=__path__.context.createImageData(1,1);a=__path__.PATH_COLOUR.data;a[3]=100;__path__.VISITED_COLOUR=__path__.context.createImageData(1,1);a=__path__.VISITED_COLOUR.data;a[3]=20;__path__.sprite.anchor.x=.5;__path__.sprite.anchor.y=.5;__path__.sprite.width=__path__.sprite.height=__path__.GRID_SIZE/__path__.CELLS_PER_METRE*
game.PIXELS_PER_METRE;__path__.sprite.name="path";__path__.sprite.zOrder=99999;game.world.spriteContainer.addChild(__path__.sprite);for(a=0;a<game.world.children.length;++a){var b=game.world.children[a];b.collisionBox&&path.updateCollisionSpace(b)}};
path.updateCollisionSpace=function(a){if(!a.collisionBox)return[];var b=__path__.entityNodes[a.id]=__path__.entityNodes[a.id]||[],c;for(c in b)c=b[c],c.entities.splice(c.entities.indexOf(a),1),c.weight=0===c.entities.length?1:0;__path__.offset.x=Math.round(__path__.centre+a.offset.x*__path__.CELLS_PER_METRE);__path__.offset.y=Math.round(__path__.centre+a.offset.y*__path__.CELLS_PER_METRE);__path__.collisionBox.x=Math.ceil(.5*a.collisionBox.x*a.size.x*__path__.CELLS_PER_METRE)-1;__path__.collisionBox.y=
Math.ceil(.5*a.collisionBox.y*a.size.y*__path__.CELLS_PER_METRE)-1;__path__.min.x=Math.min(Math.max(__path__.offset.x-__path__.collisionBox.x,0),__path__.GRID_SIZE-1);__path__.max.x=Math.min(Math.max(__path__.offset.x+__path__.collisionBox.x,0),__path__.GRID_SIZE-1);__path__.min.y=Math.min(Math.max(__path__.offset.y-__path__.collisionBox.y,0),__path__.GRID_SIZE-1);__path__.max.y=Math.min(Math.max(__path__.offset.y+__path__.collisionBox.y,0),__path__.GRID_SIZE-1);for(var d=[],e=__path__.min.y;e<=__path__.max.y;++e)for(var g=
__path__.min.x;g<=__path__.max.x;++g){c=__path__.grid[e][g];if(0===c.weight)for(a in c.entities)d.push(c.entities[a]);c.weight=0;c.entities.push(a);b.push(c)}return d};
path.updateDebugView=function(){if(!(game.timestamp<__path__.nextDebugViewUpdate)){__path__.nextDebugViewUpdate=game.timestamp+__path__.DEBUGVIEW_UPDATE_MS;__path__.context.clearRect(0,0,__path__.GRID_SIZE,__path__.GRID_SIZE);for(var a=0;a<__path__.GRID_SIZE;++a)for(var b=0;b<__path__.GRID_SIZE;++b){var c=__path__.grid[a][b];0===c.weight?__path__.context.putImageData(__path__.COLLISION_COLOUR,b,a):c.debugPath?__path__.context.putImageData(__path__.PATH_COLOUR,b,a):c.visited?__path__.context.putImageData(__path__.VISITED_COLOUR,
b,a):0!==b&&0!==a&&b!==__path__.GRID_SIZE-1&&a!==__path__.GRID_SIZE-1||__path__.context.putImageData(__path__.LIMIT_COLOUR,b,a)}__path__.sprite.texture.baseTexture.update()}};
path.willCollideAt=function(a,b){if(!a.collisionBox)return!1;__path__.offset.x=Math.round(__path__.centre+b.x*__path__.CELLS_PER_METRE);__path__.offset.y=Math.round(__path__.centre+b.y*__path__.CELLS_PER_METRE);__path__.collisionBox.x=Math.ceil(.5*a.collisionBox.x*a.size.x*__path__.CELLS_PER_METRE)-1;__path__.collisionBox.y=Math.ceil(.5*a.collisionBox.y*a.size.y*__path__.CELLS_PER_METRE)-1;__path__.min.x=Math.min(Math.max(__path__.offset.x-__path__.collisionBox.x,0),__path__.GRID_SIZE-1);__path__.max.x=
Math.min(Math.max(__path__.offset.x+__path__.collisionBox.x,0),__path__.GRID_SIZE-1);__path__.min.y=Math.min(Math.max(__path__.offset.y-__path__.collisionBox.y,0),__path__.GRID_SIZE-1);__path__.max.y=Math.min(Math.max(__path__.offset.y+__path__.collisionBox.y,0),__path__.GRID_SIZE-1);for(var c=__path__.min.y;c<=__path__.max.y;++c)for(var d=__path__.min.x;d<=__path__.max.x;++d){var e=__path__.grid[c][d];if(0===e.weight&&-1===e.entities.indexOf(a))return!0}return!1};
__path__.nodeAtOffset=function(a){var b=Math.round(__path__.centre+a.x*__path__.CELLS_PER_METRE);a=Math.round(__path__.centre+a.y*__path__.CELLS_PER_METRE);return 0>b||b>=__path__.GRID_SIZE||0>a||a>=__path__.GRID_SIZE?null:__path__.grid[a][b]};
__path__.lineOfSight=function(a,b,c){b=src_vec3__Vec3(b.offset);var d=src_vec3__Vec3.subtractVectors(c.offset,b),e=999999,g;src_vec3__Vec3.normalise(d);for(src_vec3__Vec3.multiplyScalar(d,__path__.LINE_OF_SIGHT_DELTAS);(g=src_vec3__Vec3.distanceTo(b,c.offset))<e;){if(path.willCollideAt(a,b))return!1;src_vec3__Vec3.add(b,d);e=g}return!0};
path.search=function(a,b){for(var c in __path__.dirtyNodes)c=__path__.dirtyNodes[c],c.f=0,c.g=0,c.h=0,c.visited=!1,c.closed=!1,c.parent=null,c.debugPath=!1;__path__.dirtyNodes=[];var d=__path__.nodeAtOffset(a.offset);c=__path__.nodeAtOffset(b);d.h=__path__.heuristic(d,c);__path__.dirtyNodes.push(d);for(var e=d,d=[d];d.length&&!(d.length>__path__.MAX_SEARCH_LENGTH);){var g=__path__.pop(d);if(g===c)return __path__.pathTo(g,b);g.closed=!0;for(var f in g.neighbours){f=g.neighbours[f];var k=f.visited;
if(g.parent&&__path__.lineOfSight(a,g.parent,f)){var h=__path__.getCost(a,g.parent,f);if(!f.closed&&0!==h&&(h=g.parent.g+h,!k||h<f.g)){f.visited=!0;f.parent=g.parent;f.h=f.h||__path__.heuristic(f,c);f.g=h;f.f=f.g+f.h;__path__.dirtyNodes.push(f);if(f.h<e.h||f.h===e.h&&f.g<e.g)e=f;k?__path__.sinkDown(d,d.indexOf(f)):(d.push(f),__path__.sinkDown(d,d.length-1))}}else if(h=__path__.getCost(a,g,f),!f.closed&&0!==h&&(h=g.g+h,!k||h<f.g)){f.visited=!0;f.parent=g;f.h=f.h||__path__.heuristic(f,c);f.g=h;f.f=
f.g+f.h;__path__.dirtyNodes.push(f);if(f.h<e.h||f.h===e.h&&f.g<e.g)e=f;k?__path__.sinkDown(d,d.indexOf(f)):(d.push(f),__path__.sinkDown(d,d.length-1))}}}return __path__.pathTo(e)};__path__.sinkDown=function(a,b){for(var c=a[b];0<b;){var d=(b+1>>1)-1,e=a[d];if(c.f<e.f)a[d]=c,a[b]=e,b=d;else break}};__path__.pop=function(a){var b=a[0],c=a.pop();a.length&&(a[0]=c,__path__.bubbleUp(a,0));return b};
__path__.bubbleUp=function(a,b){for(var c=a.length,d=a[b],e=d.f;;){var g=b+1<<1,f=g-1,k=null,h;f<c&&(h=a[f].f,h<e&&(k=f));g<c&&a[g].f<(null===k?e:h)&&(k=g);if(null!==k)a[b]=a[k],a[k]=d,b=k;else break}};__path__.pathTo=function(a,b){for(var c=a,d=[];c.parent;)d.push(c.offset),c.debugPath=!0,c=c.parent;b&&(d[0]=b);return d.reverse()};__path__.heuristic=function(a,b){var c=a.x-b.x,d=a.y-b.y;return Math.sqrt(c*c+d*d)};
__path__.getCost=function(a,b,c){if(path.willCollideAt(a,c.offset).length)return 0;var d=c.weight;1===c.entities.length&&c.entities[0]===a&&(d=1);return d*__path__.heuristic(b,c)};function Action(a){return{type:a&&a.type?a.type:"default",actions:[]}}Action.update=function(a){return Action[a.type].update(a)};
Action.Destination=function(a){var b=Action({type:"Destination"});b.entity=a&&a.entity?a.entity:null;b.next_offset=a&&a.next_offset?src_vec3__Vec3(a.next_offset):null;b.final_offset=a&&a.final_offset?src_vec3__Vec3(a.final_offset):src_vec3__Vec3();b.last_update=a&&a.last_update?a.last_update:game.timestamp;return b};
Action.Destination.update=function(a){var b=a.entity;if(0===b.movement_speed)return!0;var c=b.movement_speed/1E3*(game.timestamp-a.last_update);a.last_update=game.timestamp;if(0>=c)return!1;if(!a.next_offset){var d=path.search(b,a.final_offset);a.next_offset=d[0];a.final_offset=d.pop()}var d=src_vec3__Vec3.subtractVectors(a.next_offset,b.offset),e=src_vec3__Vec3.lenSq(d);src_vec3__Vec3.normalise(d);src_vec3__Vec3.multiplyScalar(d,c);if(src_vec3__Vec3.lenSq(d)>=e){if(src_vec3__Vec3.equals(a.next_offset,
a.final_offset))return Entity.setOffset(b,a.final_offset),!0;d=path.search(b,a.final_offset);a.next_offset=d[0];a.final_offset=d.pop();d=src_vec3__Vec3.subtractVectors(a.next_offset,b.offset);src_vec3__Vec3.normalise(d);src_vec3__Vec3.multiplyScalar(d,c)}src_vec3__Vec3.add(d,b.offset);Entity.setOffset(b,d);return!1};var dom=dom||{};
dom.element=function(a,b,c,d){"string"===typeof a&&(d=c,c=b,b=a);b=document.createElement(b);if(c instanceof Array||c instanceof Element)d=c;else if(c)for(var e in c)b.style[e]=c[e];if(d)for(d instanceof Array||(d=[d]),c=0;c<d.length;++c)e=d[c],"string"===typeof e?b.appendChild(document.createTextNode(e)):b.appendChild(e);a instanceof Element&&a.appendChild(b);return b};var __message__=__message__||{};
function message(a){var b=new Date,b=("00"+b.getHours()).slice(-2)+":"+("00"+b.getMinutes()).slice(-2)+":"+("00"+b.getSeconds()).slice(-2);a=dom.element("tr",[dom.element("td",{color:message.TIMESTAMP_COLOUR,verticalAlign:"top"},b),dom.element("td",{color:message.MESSAGE_COLOUR},a)]);__message__.rows.childNodes.length===message.MAX_MESSAGES&&__message__.rows.removeChild(__message__.rows.lastChild);__message__.rows.insertBefore(a,__message__.rows.firstChild)}message.MAX_MESSAGES=30;
message.MESSAGE_COLOUR="rgb(77, 143, 218)";message.TIMESTAMP_COLOUR="#777";message.FONT_SIZE="80%";__message__.dom=__message__.dom||dom.element(document.body,"div",{position:"absolute",left:"10px",bottom:"10px",background:"rgba(0, 0, 0, 0.2)",minWidth:"300px",maxWidth:"300px",minHeight:"150px",maxHeight:"150px",overflowY:"scroll",opacity:"0.5",fontSize:message.FONT_SIZE},dom.element("table",__message__.rows=dom.element("tbody")));var __entity__=__entity__||{};__entity__.byId=__entity__.byId||{};
__entity__.DEBUG_ANCHOR=!0;__entity__.DEBUG_COLLISIONBOX=!1;__entity__.COLLISIONSPACE_UPDATES_MS=333;
function Entity(a){var b={id:a&&a.id?a.id:0,name:a&&a.name?a.name:"",offset:a&&a.offset?src_Vec3__Vec3(a.offset):src_Vec3__Vec3(),size:a&&a.size?src_Vec3__Vec3(a.size):src_Vec3__Vec3({x:.5,y:.5}),anchor:a&&a.anchor?src_Vec3__Vec3(a.anchor):src_Vec3__Vec3({x:.5,y:.5}),collisionBox:a&&a.collisionBox?src_Vec3__Vec3(a.collisionBox):null,nextCollisionSpaceUpdate:0,lastCollisionSpaceOffset:src_Vec3__Vec3(),rotation:a&&a.rotation?a.rotation:0,movement_speed:a&&a.movement_speed?a.movement_speed:0,parent:null,
children:[],actions:[],model:a&&a.model?a.model:"/soba/builds/0.1.0/models/blank",spriteContainer:new PIXI.Container,spriteModel:null};b.spriteContainer.name=b.name;b.spriteContainer.zOrder=b.offset.y+1E3*b.offset.z;b.spriteModel=PIXI.Sprite.fromImage(b.model+"/sprite.png");b.spriteModel.anchor.x=.5;b.spriteModel.anchor.y=.5;b.spriteModel.alpha=.2;b.spriteContainer.addChild(b.spriteModel);if(__entity__.DEBUG_ANCHOR){var c=new PIXI.Graphics;c.beginFill(0);c.drawRect(0,0,.15*game.PIXELS_PER_METRE,.15*
game.PIXELS_PER_METRE);c=new PIXI.Sprite(c.generateTexture());c.anchor.x=.5;c.anchor.y=.5;c.alpha=.5;b.spriteContainer.addChild(c)}__entity__.DEBUG_COLLISIONBOX&&b.collisionBox&&(c=new PIXI.Graphics,c.beginFill(0),c.drawRect(0,0,b.collisionBox.x*b.size.x*game.PIXELS_PER_METRE,b.collisionBox.y*b.size.y*game.PIXELS_PER_METRE),c=new PIXI.Sprite(c.generateTexture()),c.anchor.x=.5,c.anchor.y=.5,c.alpha=.1,b.spriteContainer.addChild(c));for(;!b.id||__entity__.byId.hasOwnProperty(b.id);)b.id=~~(200+32*Math.random())<<
16|~~(200+32*Math.random())<<8|~~(200+32*Math.random());__entity__.byId[b.id]=b;a&&a.parent?Entity.addChild(a.parent,b):game.world&&Entity.addChild(game.world,b);Entity.setOffset(b,b.offset);if(a&&a.children&&a.children.length)for(c=0;c<a.children.length;++c)Entity(a.children[c]);Entity.update(b);return b}Entity.byId=__entity__.byId;Entity.addChild=function(a,b){b.parent!==a&&(b.parent&&Entity.removeChild(b.parent,b),a.children.push(b),a.spriteContainer.addChild(b.spriteContainer),b.parent=a,Entity.sortChild(b))};
Entity.removeChild=function(a){var b=a.parent.children.indexOf(a);-1<b&&a.parent.children.splice(b,1);parent.spriteContainer.removeChild(a.spriteContainer);a.parent=null};
Entity.sortChild=function(a){if(a.parent){var b=a.spriteContainer.zOrder,c=a.parent.spriteContainer.children,d=c.indexOf(a.spriteContainer),e=0<d?c[d-1]:null,g=d<c.length?c[d+1]:null;if(e&&e.zOrder>b){for(c.splice(d,1);0<d&&e.zOrder>b;)e=c[--d-1];c.splice(d,0,a.spriteContainer)}else if(g&&g.zOrder<b){for(c.splice(d,1);d<c.length&&g.zOrder<b;)g=c[++d];c.splice(d,0,a.spriteContainer)}}};
Entity.update=function(a){for(var b=a.actions.length-1;-1<b;)Action.update(a.actions[b])&&a.actions.splice(b,1),--b;if(a!==game.world&&(b=1+(game.world?a.offset.y-game.world.offset.y:-a.offset.y)*game.VERTICAL_PARRALAX,a.spriteModel.width=a.size.x*b*game.PIXELS_PER_METRE,a.spriteModel.height=a.size.y*b*game.PIXELS_PER_METRE,a.spriteModel.position.x=-((a.anchor.x-.5)*a.spriteModel.width),a.spriteModel.position.y=-((a.anchor.y-.5)*a.spriteModel.height),0===a.nextCollisionSpaceUpdate||0<a.movement_speed&&
a.nextCollisionSpaceUpdate<=game.timestamp)&&(a.nextCollisionSpaceUpdate=game.timestamp+__entity__.COLLISIONSPACE_UPDATES_MS,a.lastCollisionSpaceOffset.x!==a.offset.x||a.lastCollisionSpaceOffset.y!==a.offset.y)&&(a.lastCollisionSpaceOffset=src_Vec3__Vec3(a.offset),b=path.updateCollisionSpace(a),b.length)){var c="",d;for(d in b)d=b[d],c+=c.length?", "+d.name:d.name;message(a.name+" collides with "+c)}};
Entity.move=function(a,b){for(var c in a.actions)if(c=a.actions[c],"Destination"===c.type){c.next_offset=null;c.final_offset.x=b.x;c.final_offset.y=b.y;return}a.actions.push(Action.Destination({entity:a,final_offset:b}))};
Entity.setOffset=function(a,b){a.offset.x=b.x;a.offset.y=b.y;a.spriteContainer.position.x=a.offset.x*game.PIXELS_PER_METRE;a.spriteContainer.position.y=a.offset.y*game.PIXELS_PER_METRE;a!==game.world?(a.spriteContainer.zOrder=a.offset.y+1E3*a.offset.z,Entity.sortChild(a)):(game.world.spriteContainer.position.x=-game.world.spriteContainer.position.x,game.world.spriteContainer.position.y=-game.world.spriteContainer.position.y);"hero"===a.name&&Entity.setOffset(game.world,a.offset)};
PIXI.utils._saidHello=!0;PIXI.SCALE_MODES.DEFAULT=PIXI.SCALE_MODES.NEAREST;var game=game||{};game.RESOLUTION_WIDTH=800;game.RESOLUTION_HEIGHT=~~(game.RESOLUTION_WIDTH/(innerWidth/innerHeight));game.PIXELS_PER_METRE=game.RESOLUTION_WIDTH/20;game.VERTICAL_PARRALAX=.01;game.BEFORE_STARTTIME=-99999;game.debug=function(a){var b=new Date;console.log("["+("00"+b.getHours()).slice(-2)+":"+("00"+b.getMinutes()).slice(-2)+":"+("00"+b.getSeconds()).slice(-2)+"] "+a)};game.world||(game.world=Entity({movement_speed:2}));
var __game__=__game__||{};__game__.stage=__game__.stage||new PIXI.Container;__game__.stage.position.x=~~(.5*game.RESOLUTION_WIDTH);__game__.stage.position.y=~~(.5*game.RESOLUTION_HEIGHT);__game__.stage.addChild(game.world.spriteContainer);game.Event=function(a){a={timestamp:a&&a.timestamp?a.timestamp:game.timestamp,on_event:a&&a.on_event?a.on_event:function(){}};for(var b=__game__.events.length-1;-1<b&&__game__.events[b].timestamp>a.timestamp;)--b;__game__.events.splice(b+1,0,a);return a};
__game__.events=__game__.events||[];game.InputState=function(a){return{isDown:a&&"undefined"!==typeof a.isDown?a.isDown:!1,lastDown:a&&"undefined"!==typeof a.lastDown?a.lastDown:game.BEFORE_STARTTIME}};__game__.inputStates=__game__.inputStates||{};game.input=function(a){__game__.inputStates.hasOwnProperty(a)||(__game__.inputStates[a]=game.InputState({isDown:!1,lastDown:game.BEFORE_STARTTIME}));return __game__.inputStates[a]};game.KEY_ENTER=13;game.KEY_ESC=27;game.KEY_SPACE=32;game.KEY_LEFT=37;
game.KEY_UP=38;game.KEY_RIGHT=39;game.KEY_DOWN=40;game.MOUSE_LBUTTON=0;game.MOUSE_MBUTTON=1;game.MOUSE_RBUTTON=2;game.MOUSE_OFFSET=-1;game.read=function(a){(a=localStorage.getItem(a))&&(a=JSON.parse(a));return a};game.memory=game.memory||game.read("Memory")||{};game.write=function(a,b){return localStorage.setItem(a,JSON.stringify(b))};game.timestamp=game.timestamp||0;game.elapsed=game.elapsed||0;game.update=game.update||function(){};
__game__.update=function(a){requestAnimationFrame(__game__.update);game.elapsed=a-game.timestamp;game.timestamp=a;for(a=__game__.events;a.length&&a[a.length-1].timestamp<=game.timestamp;){var b=a.pop();b.on_event(b);if(b.timestamp>game.timestamp){for(var c=a.length-1;-1<c&&a[c].timestamp<b.timestamp;)--c;a.splice(c+1,0,b)}}game.update();for(var d in Entity.byId)d=Entity.byId[d],Entity.update(d);__game__.renderer.render(__game__.stage)};
__game__.keyDown=function(a){__game__.inputStates.hasOwnProperty(a.keyCode)?__game__.inputStates[a.keyCode].isDown=!0:__game__.inputStates[a.keyCode]=game.InputState({isDown:!0})};__game__.keyUp=function(a){__game__.inputStates.hasOwnProperty(a.keyCode)?(__game__.inputStates[a.keyCode].isDown=!1,__game__.inputStates[a.keyCode].lastDown=game.timestamp):__game__.inputStates[a.keyCode]=game.InputState({lastDown:game.timestamp})};
__game__.mouseMove=function(a){var b=__game__.inputStates[game.MOUSE_OFFSET];b.x=game.world.offset.x+(a.pageX/innerWidth-.5)*game.RESOLUTION_WIDTH/game.PIXELS_PER_METRE;b.y=game.world.offset.y+(a.pageY/innerHeight-.5)*game.RESOLUTION_HEIGHT/game.PIXELS_PER_METRE};__game__.contextMenu=function(a){a.preventDefault()};__game__.mouseDown=function(a){a.preventDefault();__game__.inputStates[a.button].isDown=!0};
__game__.mouseUp=function(a){a.preventDefault();__game__.inputStates[a.button].lastDown=game.timestamp;__game__.inputStates[a.button].isDown=!1};__game__.resize=function(){game.RESOLUTION_HEIGHT=~~(game.RESOLUTION_WIDTH/(innerWidth/innerHeight));__game__.renderer.resize(game.RESOLUTION_WIDTH,game.RESOLUTION_HEIGHT);__game__.stage.position.x=~~(.5*game.RESOLUTION_WIDTH);__game__.stage.position.y=~~(.5*game.RESOLUTION_HEIGHT)};
__game__.listen=function(a,b){(function(c){window.addEventListener(a,function(a){c||(b(a),c=setTimeout(function(){c=null},66))},!1)})()};
__game__.initialised||(document.body.style.overflow="hidden",document.body.style.margin=document.body.style.padding="0",__game__.inputStates[game.MOUSE_OFFSET]=src_Vec3__Vec3(),__game__.inputStates[game.MOUSE_LBUTTON]=game.InputState(),__game__.inputStates[game.MOUSE_MBUTTON]=game.InputState(),__game__.inputStates[game.MOUSE_RBUTTON]=game.InputState(),__game__.listen("keydown",__game__.keyDown),__game__.listen("keyup",__game__.keyUp),__game__.listen("mousemove",__game__.mouseMove),__game__.listen("contextmenu",
__game__.contextMenu),__game__.listen("mousedown",__game__.mouseDown),__game__.listen("mouseup",__game__.mouseUp),__game__.listen("resize",__game__.resize),addEventListener("beforeunload",function(){game.write("Memory",game.memory)},!1),__game__.renderer=new PIXI.WebGLRenderer(game.RESOLUTION_WIDTH,game.RESOLUTION_HEIGHT,{transparent:!0}),__game__.renderer.view.style.width="100%",__game__.renderer.view.style.height="100%",document.body.appendChild(__game__.renderer.view),requestAnimationFrame(function(a){__game__.update(a)}),
"localhost"===location.hostname&&setInterval(function(){var a=new XMLHttpRequest;a.open("GET","/liveupdate");a.onload=function(a){if(200===this.status){a=JSON.parse(this.response);for(var c in a){var d=document.body,e=document.createElement("script");c=a[c];e.src=c;var g=document.evaluate('//script[ @src="'+c+'" ]',document,null,XPathResult.ANY_TYPE,null).iterateNext();g?(d=g.parentNode,d.removeChild(g),game.debug("liveupdate replaced "+c)):game.debug("liveupdate added "+c);d.appendChild(e)}}};a.send()},
2E3),__game__.initialised=!0,game.debug("initialised"));function HeroEntity(a){a=a||{};a.model="/soba/builds/0.1.0/models/troubadour";a.name=a.name?a.name:"hero";a.offset=a.offset?src_Vec3__Vec3(a.offset):src_Vec3__Vec3();a.size=a.size?src_Vec3__Vec3(a.size):src_Vec3__Vec3({x:1.2,y:1.8});a.anchor=src_Vec3__Vec3({x:.38,y:.84});a.collisionBox=src_Vec3__Vec3({x:.6,y:.2});a.movement_speed=2;return Entity(a)}
function TreeEntity(a){a=a||{};a.model="/soba/builds/0.1.0/models/tree";a.name=a.name?a.name:"tree";a.offset=a.offset?src_Vec3__Vec3(a.offset):src_Vec3__Vec3();a.size=a.size?src_Vec3__Vec3(a.size):src_Vec3__Vec3({x:3,y:6});a.anchor=src_Vec3__Vec3({x:.54,y:.87});a.collisionBox=src_Vec3__Vec3({x:.3,y:.12});return Entity(a)}
function RockEntity(a){a=a||{};a.model="/soba/builds/0.2.0/models/rock";a.name=a.name?a.name:"rock";a.offset=a.offset?src_Vec3__Vec3(a.offset):src_Vec3__Vec3();a.size=a.size?src_Vec3__Vec3(a.size):src_Vec3__Vec3({x:2,y:2});a.anchor=src_Vec3__Vec3({x:.38,y:.6});a.collisionBox=src_Vec3__Vec3({x:.7,y:.4});return Entity(a)}
function GrassEntity(a){a=a||{};a.model="/soba/builds/0.1.0/models/grass";a.name=a.name?a.name:"grass";a.offset=a.offset?src_Vec3__Vec3(a.offset):src_Vec3__Vec3();a.size=a.size?src_Vec3__Vec3(a.size):src_Vec3__Vec3({x:2,y:1});a.anchor=src_Vec3__Vec3({x:.5,y:.7});return Entity(a)}
function BaseEntity(a){a=a||{};a.model="/soba/builds/0.2.0/models/base";a.name=a.name?a.name:"base";a.offset=a.offset?src_Vec3__Vec3(a.offset):src_Vec3__Vec3();a.size=a.size?src_Vec3__Vec3(a.size):src_Vec3__Vec3({x:10,y:10});a.anchor=src_Vec3__Vec3({x:.5,y:.5});return Entity(a)}var map=map||{};map.base=map.base||BaseEntity({offset:src_Vec3__Vec3({x:0,y:0,z:-1})});map.tree001=map.tree001||TreeEntity({name:"tree001",offset:src_Vec3__Vec3({x:-9,y:1}),size:src_Vec3__Vec3({x:4,y:6})});
map.tree002=map.tree002||TreeEntity({name:"tree002",offset:src_Vec3__Vec3({x:-6,y:-1}),size:src_Vec3__Vec3({x:4,y:5})});map.tree003=map.tree003||TreeEntity({name:"tree003",offset:src_Vec3__Vec3({x:-9,y:5}),size:src_Vec3__Vec3({x:4,y:5})});map.tree004=map.tree004||TreeEntity({name:"tree004",offset:src_Vec3__Vec3({x:-5,y:3}),size:src_Vec3__Vec3({x:6,y:5})});map.rock001=map.rock001||RockEntity({name:"rock001",offset:src_Vec3__Vec3({x:-4,y:-2}),size:src_Vec3__Vec3({x:3,y:3})});
map.rock002=map.rock002||RockEntity({name:"rock002",offset:src_Vec3__Vec3({x:-7,y:2}),size:src_Vec3__Vec3({x:5,y:7.5})});map.rock003=map.rock003||RockEntity({name:"rock003",offset:src_Vec3__Vec3({x:-7,y:.1}),size:src_Vec3__Vec3({x:2,y:3})});map.rock004=map.rock004||RockEntity({name:"rock004",offset:src_Vec3__Vec3({x:-8.5,y:-1}),size:src_Vec3__Vec3({x:3,y:3})});var __soba__=__soba__||{};__soba__.mouseLastDown=__soba__.mouseLastDown||game.BEFORE_STARTTIME;__soba__.HERO_MOVE_DEADZONE=.15;
__soba__.HERO_MOVE_TIMEGAP=250;map.hero=map.hero||HeroEntity({offset:src_Vec3__Vec3({x:0,y:0})});
game.update=function(){var a=game.input(game.MOUSE_LBUTTON),b=game.input(game.MOUSE_RBUTTON);(a.isDown||b.isDown||a.lastDown>__soba__.mouseLastDown||b.lastDown>__soba__.mouseLastDown)&&game.timestamp-__soba__.mouseLastDown>__soba__.HERO_MOVE_TIMEGAP&&(__soba__.mouseLastDown=game.timestamp,a=src_Vec3__Vec3(game.input(game.MOUSE_OFFSET)),src_Vec3__Vec3.distanceToSq(map.hero.offset,a)>__soba__.HERO_MOVE_DEADZONE&&Entity.move(map.hero,a))};
__soba__.pathInitialised||(path.initialise(),__soba__.pathInitialised=!0,message("SOBA 0.4.0"));
		</script>
	</body>
</html>