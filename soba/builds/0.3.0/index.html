<!doctype html>
<html>
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1" />
		<link rel="icon" href="data:;base64,iVBORw0KGgo=">
		<title>soba</title>
		<style>
			html, body { margin: 0; padding: 0; font-family: sans-serif; font-size: 110%; width: 100%; height: 100%; }
			* { box-sizing: border-box; }
		</style>
		<script src="../0.1.0/lib/pixi.js"></script>
	</head>
	<body>
		<script>
function src_Vec3__Vec3(a){return{x:a&&a.x?a.x:0,y:a&&a.y?a.y:0,z:a&&a.z?a.z:0}}src_Vec3__Vec3.equals=function(a,b){return b.x===a.x&&b.y===a.y&&b.z===a.z};src_Vec3__Vec3.add=function(a,b){a.x+=b.x;a.y+=b.y;a.z+=b.z;return a};src_Vec3__Vec3.addVectors=function(a,b){return src_Vec3__Vec3.add(src_Vec3__Vec3(a),b)};src_Vec3__Vec3.addScalar=function(a,b){a.x+=b;a.y+=b;a.z+=b;return a};src_Vec3__Vec3.subtract=function(a,b){a.x-=b.x;a.y-=b.y;a.z-=b.z;return a};
src_Vec3__Vec3.subtractVectors=function(a,b){return src_Vec3__Vec3.subtract(src_Vec3__Vec3(a),b)};src_Vec3__Vec3.multiply=function(a,b){a.x*=b.x;a.y*=b.y;a.z*=b.z;return a};src_Vec3__Vec3.multiplyScalar=function(a,b){a.x*=b;a.y*=b;a.z*=b;return a};src_Vec3__Vec3.divide=function(a,b){a.x/=b.x;a.y/=b.y;a.z/=b.z;return a};src_Vec3__Vec3.divideScalar=function(a,b){if(0!==b){var c=1/b;a.x*=c;a.y*=c;a.z*=c}else a.x=0,a.y=0,a.z=0;return a};
src_Vec3__Vec3.clamp=function(a,b,c){a.x<b.x?a.x=b.x:a.x>c.x&&(a.x=c.x);a.y<b.y?a.y=b.y:a.y>c.y&&(a.y=c.y);a.z<b.z?a.z=b.z:a.z>c.z&&(a.z=c.z);return a};src_Vec3__Vec3.floor=function(a){a.x=Math.floor(a.x);a.y=Math.floor(a.y);a.z=Math.floor(a.z);return a};src_Vec3__Vec3.ceil=function(a){a.x=Math.ceil(a.x);a.y=Math.ceil(a.y);a.z=Math.ceil(a.z);return a};src_Vec3__Vec3.round=function(a){a.x=Math.round(a.x);a.y=Math.round(a.y);a.z=Math.round(a.z);return a};
src_Vec3__Vec3.roundToZero=function(a){a.x=0>a.x?Math.ceil(a.x):Math.floor(a.x);a.y=0>a.y?Math.ceil(a.y):Math.floor(a.y);a.z=0>a.z?Math.ceil(a.z):Math.floor(a.z);return a};src_Vec3__Vec3.negate=function(a){a.x=-a.x;a.y=-a.y;a.z=-a.z;return a};src_Vec3__Vec3.dot=function(a,b){return a.x*b.x+a.y*b.y+a.z*b.z};src_Vec3__Vec3.lenSq=function(a){return a.x*a.x+a.y*a.y+a.z*a.z};src_Vec3__Vec3.len=function(a){return Math.sqrt(src_Vec3__Vec3.lenSq(a))};
src_Vec3__Vec3.normalise=function(a){return src_Vec3__Vec3.divideScalar(a,src_Vec3__Vec3.len(a))};src_Vec3__Vec3.distanceToSq=function(a,b){var c=a.x-b.x,d=a.y-b.y,e=a.z-b.z;return c*c+d*d+e*e};src_Vec3__Vec3.distanceTo=function(a,b){return Math.sqrt(src_Vec3__Vec3.distanceToSq(a,b))};src_Vec3__Vec3.setLen=function(a,b){var c=src_Vec3__Vec3.len(a);0!==c&&b!==c&&src_Vec3__Vec3.multiplyScalar(a,b/c);return a};src_Vec3__Vec3.lerp=function(a,b,c){a.x+=(b.x-a.x)*c;a.y+=(b.y-a.y)*c;a.z+=(b.z-a.z)*c;return a};
function src_vec3__Vec3(a){return{x:a&&a.x?a.x:0,y:a&&a.y?a.y:0,z:a&&a.z?a.z:0}}src_vec3__Vec3.equals=function(a,b){return b.x===a.x&&b.y===a.y&&b.z===a.z};src_vec3__Vec3.add=function(a,b){a.x+=b.x;a.y+=b.y;a.z+=b.z;return a};src_vec3__Vec3.addVectors=function(a,b){return src_vec3__Vec3.add(src_vec3__Vec3(a),b)};src_vec3__Vec3.addScalar=function(a,b){a.x+=b;a.y+=b;a.z+=b;return a};src_vec3__Vec3.subtract=function(a,b){a.x-=b.x;a.y-=b.y;a.z-=b.z;return a};
src_vec3__Vec3.subtractVectors=function(a,b){return src_vec3__Vec3.subtract(src_vec3__Vec3(a),b)};src_vec3__Vec3.multiply=function(a,b){a.x*=b.x;a.y*=b.y;a.z*=b.z;return a};src_vec3__Vec3.multiplyScalar=function(a,b){a.x*=b;a.y*=b;a.z*=b;return a};src_vec3__Vec3.divide=function(a,b){a.x/=b.x;a.y/=b.y;a.z/=b.z;return a};src_vec3__Vec3.divideScalar=function(a,b){if(0!==b){var c=1/b;a.x*=c;a.y*=c;a.z*=c}else a.x=0,a.y=0,a.z=0;return a};
src_vec3__Vec3.clamp=function(a,b,c){a.x<b.x?a.x=b.x:a.x>c.x&&(a.x=c.x);a.y<b.y?a.y=b.y:a.y>c.y&&(a.y=c.y);a.z<b.z?a.z=b.z:a.z>c.z&&(a.z=c.z);return a};src_vec3__Vec3.floor=function(a){a.x=Math.floor(a.x);a.y=Math.floor(a.y);a.z=Math.floor(a.z);return a};src_vec3__Vec3.ceil=function(a){a.x=Math.ceil(a.x);a.y=Math.ceil(a.y);a.z=Math.ceil(a.z);return a};src_vec3__Vec3.round=function(a){a.x=Math.round(a.x);a.y=Math.round(a.y);a.z=Math.round(a.z);return a};
src_vec3__Vec3.roundToZero=function(a){a.x=0>a.x?Math.ceil(a.x):Math.floor(a.x);a.y=0>a.y?Math.ceil(a.y):Math.floor(a.y);a.z=0>a.z?Math.ceil(a.z):Math.floor(a.z);return a};src_vec3__Vec3.negate=function(a){a.x=-a.x;a.y=-a.y;a.z=-a.z;return a};src_vec3__Vec3.dot=function(a,b){return a.x*b.x+a.y*b.y+a.z*b.z};src_vec3__Vec3.lenSq=function(a){return a.x*a.x+a.y*a.y+a.z*a.z};src_vec3__Vec3.len=function(a){return Math.sqrt(src_vec3__Vec3.lenSq(a))};
src_vec3__Vec3.normalise=function(a){return src_vec3__Vec3.divideScalar(a,src_vec3__Vec3.len(a))};src_vec3__Vec3.distanceToSq=function(a,b){var c=a.x-b.x,d=a.y-b.y,e=a.z-b.z;return c*c+d*d+e*e};src_vec3__Vec3.distanceTo=function(a,b){return Math.sqrt(src_vec3__Vec3.distanceToSq(a,b))};src_vec3__Vec3.setLen=function(a,b){var c=src_vec3__Vec3.len(a);0!==c&&b!==c&&src_vec3__Vec3.multiplyScalar(a,b/c);return a};src_vec3__Vec3.lerp=function(a,b,c){a.x+=(b.x-a.x)*c;a.y+=(b.y-a.y)*c;a.z+=(b.z-a.z)*c;return a};
var path=path||{},__path__=__path__||{};__path__.GRID_SIZE=250;__path__.CELLS_PER_METRE=3;__path__.DEBUG_COLLISIONBOX=!0;__path__.UPDATE_MS=66;__path__.pathLastUpdate=__path__.pathLastUpdate||-99999;__path__.GridNode=function(a,b){return{offset:src_vec3__Vec3(),entities:[],weight:0,f:0,g:0,h:0,visited:!1,closed:!1,parent:null,debugPath:!1,north:null,northeast:null,east:null,southeast:null,south:null,southwest:null,west:null,northwest:null,neighbours:[]}};__path__.grid=__path__.grid||[];
__path__.entityNodes=__path__.entityNodes||{};__path__.dirtyNodes=__path__.dirtyNodes||[];__path__.centre=__path__.centre||~~(.5*__path__.GRID_SIZE);__path__.offset=__path__.offset||src_vec3__Vec3();__path__.collisionBox=__path__.collisionBox||src_vec3__Vec3();__path__.min=__path__.min||src_vec3__Vec3();__path__.max=__path__.max||src_vec3__Vec3();
if(!__path__.grid.length){for(var y=0;y<__path__.GRID_SIZE;++y){__path__.grid[y]=[];for(var x=0;x<__path__.GRID_SIZE;++x){var node=__path__.grid[y][x]=__path__.GridNode();node.offset.x=(x-__path__.centre)/__path__.CELLS_PER_METRE;node.offset.y=(y-__path__.centre)/__path__.CELLS_PER_METRE}}for(y=0;y<__path__.GRID_SIZE;++y)for(x=0;x<__path__.GRID_SIZE;++x)node=__path__.grid[y][x],node.north=0<y?__path__.grid[y-1][x]:null,node.northeast=0<y&&x<__path__.GRID_SIZE-1?__path__.grid[y-1][x+1]:null,node.east=
x<__path__.GRID_SIZE-1?__path__.grid[y][x+1]:null,node.southeast=x<__path__.GRID_SIZE-1&&y<__path__.GRID_SIZE-1?__path__.grid[y+1][x+1]:null,node.south=y<__path__.GRID_SIZE-1?__path__.grid[y+1][x]:null,node.southwest=0<x&&y<__path__.GRID_SIZE-1?__path__.grid[y+1][x-1]:null,node.west=0<x?__path__.grid[y][x-1]:null,node.northwest=0<x&&0<y?__path__.grid[y-1][x-1]:null,node.neighbours=[],node.north&&node.neighbours.push(node.north),node.northeast&&node.neighbours.push(node.northeast),node.east&&node.neighbours.push(node.east),
node.southeast&&node.neighbours.push(node.southeast),node.south&&node.neighbours.push(node.south),node.southwest&&node.neighbours.push(node.southwest),node.west&&node.neighbours.push(node.west),node.northwest&&node.neighbours.push(node.northwest)}
path.initialise=function(){__path__.canvas=document.createElement("canvas");__path__.canvas.width=__path__.GRID_SIZE;__path__.canvas.height=__path__.GRID_SIZE;__path__.canvas.style.imageRendering="pixelated";__path__.sprite=new PIXI.Sprite(PIXI.Texture.fromCanvas(__path__.canvas));__path__.context=__path__.canvas.getContext("2d",{antialias:!1,depth:!1});__path__.CLEAR_COLOUR=__path__.context.createImageData(1,1);var a=__path__.CLEAR_COLOUR.data;a[3]=0;__path__.EDGE_COLOUR=__path__.context.createImageData(1,
1);a=__path__.EDGE_COLOUR.data;a[0]=a[2]=255;a[3]=200;__path__.COLLISION_COLOUR=__path__.context.createImageData(1,1);a=__path__.COLLISION_COLOUR.data;a[0]=255;a[3]=200;__path__.NEAR_COLLISION_COLOUR=__path__.context.createImageData(1,1);a=__path__.NEAR_COLLISION_COLOUR.data;a[0]=128;a[3]=100;__path__.PATH_COLOUR=__path__.context.createImageData(1,1);a=__path__.PATH_COLOUR.data;a[1]=255;a[3]=200;__path__.VISITED_COLOUR=__path__.context.createImageData(1,1);a=__path__.VISITED_COLOUR.data;a[1]=a[2]=
255;a[3]=200;__path__.sprite.anchor.x=.5;__path__.sprite.anchor.y=.5;__path__.sprite.width=__path__.sprite.height=__path__.GRID_SIZE/__path__.CELLS_PER_METRE*game.PIXELS_PER_METRE;__path__.sprite.name="path";__path__.sprite.zOrder=99999;game.world.spriteContainer.addChild(__path__.sprite);for(a=0;a<game.world.children.length;++a){var b=game.world.children[a];b.collisionBox&&path.updateCollisionSpace(b)}};
path.updateCollisionSpace=function(a){if(a.collisionBox){if(__path__.entityNodes.hasOwnProperty(a.id)){var b=__path__.entityNodes[a.id],c;for(c in b)c=b[c],c.entities.splice(c.entities.indexOf(a),1),c.weight=0===c.entities.length?0:1}__path__.entityNodes[a.id]=[];__path__.offset.x=__path__.centre+a.offset.x*__path__.CELLS_PER_METRE;__path__.offset.y=__path__.centre+a.offset.y*__path__.CELLS_PER_METRE;__path__.collisionBox.x=.5*a.collisionBox.x*a.size.x*__path__.CELLS_PER_METRE;__path__.collisionBox.y=
.5*a.collisionBox.y*a.size.y*__path__.CELLS_PER_METRE;__path__.min.x=Math.round(__path__.offset.x-__path__.collisionBox.x);__path__.max.x=Math.round(__path__.offset.x+__path__.collisionBox.x);__path__.min.y=Math.round(__path__.offset.y-__path__.collisionBox.y);__path__.max.y=Math.round(__path__.offset.y+__path__.collisionBox.y);for(b=__path__.min.y;b<__path__.max.y;++b)for(c=__path__.min.x;c<__path__.max.x;++c)0>c||c>=__path__.GRID_SIZE||0>b||b>=__path__.GRID_SIZE||(__path__.grid[b][c].weight=1,__path__.grid[b][c].entities.push(a),
__path__.entityNodes[a.id].push(__path__.grid[b][c]))}};
path.updateDebugView=function(){if(!(game.timestamp<__path__.pathLastUpdate+__path__.UPDATE_MS)){__path__.pathLastUpdate=game.timestamp;__path__.context.clearRect(0,0,__path__.GRID_SIZE,__path__.GRID_SIZE);for(var a=0;a<__path__.GRID_SIZE;++a)for(var b=0;b<__path__.GRID_SIZE;++b)1<=__path__.grid[a][b].weight?__path__.context.putImageData(__path__.COLLISION_COLOUR,b,a):0<__path__.grid[a][b].weight?__path__.context.putImageData(__path__.NEAR_COLLISION_COLOUR,b,a):__path__.grid[a][b].debugPath?__path__.context.putImageData(__path__.PATH_COLOUR,
b,a):__path__.grid[a][b].visited?__path__.context.putImageData(__path__.VISITED_COLOUR,b,a):0!==b&&0!==a&&b!==__path__.GRID_SIZE-1&&a!==__path__.GRID_SIZE-1||__path__.context.putImageData(__path__.EDGE_COLOUR,b,a);__path__.sprite.texture.baseTexture.update()}};
path.findCollisions=function(a,b){if(a.collisionBox){__path__.offset.x=__path__.centre+b.x*__path__.CELLS_PER_METRE;__path__.offset.y=__path__.centre+b.y*__path__.CELLS_PER_METRE;__path__.collisionBox.x=.5*a.collisionBox.x*a.size.x*__path__.CELLS_PER_METRE;__path__.collisionBox.y=.5*a.collisionBox.y*a.size.y*__path__.CELLS_PER_METRE;__path__.min.x=Math.round(__path__.offset.x-__path__.collisionBox.x);__path__.max.x=Math.round(__path__.offset.x+__path__.collisionBox.x);__path__.min.y=Math.round(__path__.offset.y-
__path__.collisionBox.y);__path__.max.y=Math.round(__path__.offset.y+__path__.collisionBox.y);for(var c=[],d=__path__.min.y;d<__path__.max.y;++d)for(var e=__path__.min.x;e<__path__.max.x;++e)if(!(0>e||e>=__path__.GRID_SIZE||0>d||d>=__path__.GRID_SIZE)){var g=__path__.grid[d][e];if(1===g.weight)for(var f in g.entities)f=g.entities[f],f.id!==a.id&&c.push(f)}return c}};
__path__.nodeAtOffset=function(a){var b=Math.round(__path__.centre+a.x*__path__.CELLS_PER_METRE);a=Math.round(__path__.centre+a.y*__path__.CELLS_PER_METRE);return 0>b||b>=__path__.GRID_SIZE||0>a||a>=__path__.GRID_SIZE?null:__path__.grid[a][b]};
path.search=function(a,b){for(var c in __path__.dirtyNodes)c=__path__.dirtyNodes[c],c.f=0,c.g=0,c.h=0,c.visited=!1,c.closed=!1,c.parent=null,c.debugPath=!1;__path__.dirtyNodes=[];var d=__path__.nodeAtOffset(a.offset);c=__path__.nodeAtOffset(b);d.h=src_vec3__Vec3.distanceTo(d.offset,c.offset);__path__.dirtyNodes.push(d);for(var e=d,d=[d];d.length&&!(150<d.length);){var g=__path__.pop(d);if(g===c)return __path__.pathTo(a,g,c);g.closed=!0;for(var f in g.neighbours){f=g.neighbours[f];var h=__path__.getCost(a,
g,f);if(!(f.closed||1<=h)){var h=g.g+h,k=f.visited;if(!k||h<f.g){f.visited=!0;f.parent=g;f.h=f.h||src_vec3__Vec3.distanceTo(f.offset,c.offset);f.g=h;f.f=f.g+f.h;__path__.dirtyNodes.push(f);if(f.h<e.h||f.h===e.h&&f.g<e.g)e=f;k?__path__.sinkDown(d,d.indexOf(f)):(d.push(f),__path__.sinkDown(d,d.length-1))}}}}return __path__.pathTo(a,e,c)};__path__.sinkDown=function(a,b){for(var c=a[b];0<b;){var d=(b+1>>1)-1,e=a[d];if(c.f<e.f)a[d]=c,a[b]=e,b=d;else break}};
__path__.pop=function(a){var b=a[0],c=a.pop();a.length&&(a[0]=c,__path__.bubbleUp(a,0));return b};__path__.bubbleUp=function(a,b){for(var c=a.length,d=a[b],e=d.f;;){var g=b+1<<1,f=g-1,h=null,k;f<c&&(k=a[f].f,k<e&&(h=f));g<c&&a[g].f<(null===h?e:k)&&(h=g);if(null!==h)a[b]=a[h],a[h]=d,b=h;else break}};
__path__.pathTo=function(a,b,c){for(var d=[];b.parent;){if(b===c)d.push(b.offset),b.debugPath=!0;else{path.findCollisions(a,b.offset).length&&(d.push(b.offset),b.debugPath=!0);for(var e in b.neighbours)if(e=b.neighbours[e],path.findCollisions(a,e.offset).length){d.push(b.offset);b.debugPath=!0;break}}b=b.parent}return d.reverse()};__path__.heuristic=function(a,b){var c=Math.sqrt(2),d=Math.abs(b.offset.x-a.offset.x),e=Math.abs(b.offset.y-a.offset.y);return 1*(d+e)+(c-2)*Math.min(d,e)};
__path__.getCost=function(a,b,c){if(path.findCollisions(a,c.offset).length)return 1;var d=c.weight;return 1===c.entities.length&&c.entities[0]===a?0:b.x!=c.x&&b.y!=c.y?1.41421*d:d};function Action(a){return{type:a&&a.type?a.type:"default",actions:[]}}Action.update=function(a){return Action[a.type].update(a)};
Action.Destination=function(a){var b=Action({type:"Destination"});b.entity=a&&a.entity?a.entity:null;b.offset=a&&a.offset?src_vec3__Vec3(a.offset):src_vec3__Vec3();b.last_update=a&&a.last_update?a.last_update:game.timestamp;return b};
Action.Destination.update=function(a){var b=a.entity;if(0===b.movement_speed)return!0;var c=b.movement_speed/1E3*(game.timestamp-a.last_update);a.last_update=game.timestamp;if(0>=c)return!1;var d=src_vec3__Vec3.subtractVectors(a.offset,b.offset);src_vec3__Vec3.lenSq(d)<c*c?d=a.offset:(src_vec3__Vec3.normalise(d),src_vec3__Vec3.multiplyScalar(d,c),src_vec3__Vec3.add(d,b.offset));c=path.findCollisions(b,d);if(c.length){a="";for(var e in c)a+=a.length?" and "+c[e].name:" "+c[e].name;console.log(b.name+
" collides with"+a);return!0}if(d===a.offset)return Entity.setOffset(b,a.offset),!0;Entity.setOffset(b,d);return!1};var __entity__=__entity__||{};__entity__.byId=__entity__.byId||{};__entity__.DEBUG_ANCHOR=!0;__entity__.DEBUG_COLLISIONBOX=!0;
function Entity(a){var b={id:0,name:a&&a.name?a.name:"",offset:a&&a.offset?src_Vec3__Vec3(a.offset):src_Vec3__Vec3(),size:a&&a.size?src_Vec3__Vec3(a.size):src_Vec3__Vec3({x:.5,y:.5}),anchor:a&&a.anchor?src_Vec3__Vec3(a.anchor):src_Vec3__Vec3({x:.5,y:.5}),collisionBox:a&&a.collisionBox?src_Vec3__Vec3(a.collisionBox):null,rotation:a&&a.rotation?a.rotation:0,movement_speed:a&&a.movement_speed?a.movement_speed:0,parent:null,children:[],actions:[],model:a&&a.model?a.model:"unknown",spriteContainer:new PIXI.Container,
spriteModel:null};b.spriteContainer.name=b.name;b.spriteContainer.zOrder=b.offset.y+1E3*b.offset.z;b.spriteModel=PIXI.Sprite.fromImage(b.model+"/sprite.png");b.spriteModel.anchor.x=.5;b.spriteModel.anchor.y=.5;b.spriteContainer.addChild(b.spriteModel);if(__entity__.DEBUG_ANCHOR){var c=new PIXI.Graphics;c.beginFill(7829503);c.drawRect(0,0,.15*game.PIXELS_PER_METRE,.15*game.PIXELS_PER_METRE);c=new PIXI.Sprite(c.generateTexture());c.anchor.x=.5;c.anchor.y=.5;c.alpha=.5;b.spriteContainer.addChild(c)}__entity__.DEBUG_COLLISIONBOX&&
b.collisionBox&&(c=new PIXI.Graphics,c.beginFill(16742263),c.drawRect(0,0,b.collisionBox.x*b.size.x*game.PIXELS_PER_METRE,b.collisionBox.y*b.size.y*game.PIXELS_PER_METRE),c=new PIXI.Sprite(c.generateTexture()),c.anchor.x=.5,c.anchor.y=.5,c.alpha=.5,b.spriteContainer.addChild(c));for(;!b.id||__entity__.byId.hasOwnProperty(b.id);)b.id=~~(200+32*Math.random())<<16|~~(200+32*Math.random())<<8|~~(200+32*Math.random());__entity__.byId[b.id]=b;a&&a.parent&&Entity.addChild(a.parent,b);Entity.setOffset(b,
b.offset);if(a&&a.children&&a.children.length)for(c=0;c<a.children.length;++c)Entity(a.children[c]);Entity.update(b);return b}Entity.byId=__entity__.byId;Entity.addChild=function(a,b){b.parent!==a&&(b.parent&&Entity.removeChild(b.parent,b),a.children.push(b),a.spriteContainer.addChild(b.spriteContainer),b.parent=a,Entity.sortChild(b))};
Entity.removeChild=function(a){var b=a.parent.children.indexOf(a);-1<b&&a.parent.children.splice(b,1);parent.spriteContainer.removeChild(a.spriteContainer);a.parent=null};
Entity.sortChild=function(a){if(a.parent){var b=a.spriteContainer.zOrder,c=a.parent.spriteContainer.children,d=c.indexOf(a.spriteContainer),e=0<d?c[d-1]:null,g=d<c.length?c[d+1]:null;if(e&&e.zOrder>b){for(c.splice(d,1);0<d&&e.zOrder>b;)e=c[--d-1];c.splice(d,0,a.spriteContainer)}else if(g&&g.zOrder<b){for(c.splice(d,1);d<c.length&&g.zOrder<b;)g=c[++d];c.splice(d,0,a.spriteContainer)}}};
Entity.update=function(a){for(var b=0;b<a.actions.length;++b)Action.update(a.actions[b])&&(a.actions.splice(b,1),--b);a!==game.world&&(b=1+(game.world?a.offset.y-game.world.offset.y:-a.offset.y)*game.VERTICAL_PARRALAX,a.spriteModel.width=a.size.x*b*game.PIXELS_PER_METRE,a.spriteModel.height=a.size.y*b*game.PIXELS_PER_METRE,a.spriteModel.position.x=-((a.anchor.x-.5)*a.spriteModel.width),a.spriteModel.position.y=-((a.anchor.y-.5)*a.spriteModel.height))};
Entity.move=function(a,b){b=path.search(a,b)[0];for(var c in a.actions)if(c=a.actions[c],"Destination"===c.type){c.offset.x=b.x;c.offset.y=b.y;return}a.actions.push(Action.Destination({entity:a,offset:b}))};
Entity.setOffset=function(a,b){a.offset.x=b.x;a.offset.y=b.y;a.spriteContainer.position.x=a.offset.x*game.PIXELS_PER_METRE;a.spriteContainer.position.y=a.offset.y*game.PIXELS_PER_METRE;a!==game.world?(path.updateCollisionSpace(a),a.spriteContainer.zOrder=a.offset.y+1E3*a.offset.z,Entity.sortChild(a)):(game.world.spriteContainer.position.x=-game.world.spriteContainer.position.x,game.world.spriteContainer.position.y=-game.world.spriteContainer.position.y);"hero"===a.name&&Entity.setOffset(game.world,
a.offset)};PIXI.utils._saidHello=!0;var game=game||{};game.RESOLUTION_WIDTH=800;game.RESOLUTION_HEIGHT=~~(game.RESOLUTION_WIDTH/(innerWidth/innerHeight));game.PIXELS_PER_METRE=game.RESOLUTION_WIDTH/20;game.VERTICAL_PARRALAX=.01;game.debug=function(a){var b=new Date;console.log("["+("00"+b.getHours()).slice(-2)+":"+("00"+b.getMinutes()).slice(-2)+":"+("00"+b.getSeconds()).slice(-2)+"] "+a)};game.world||(game.world=Entity({model:"../0.1.0/models/blank",movement_speed:2}));var __game__=__game__||{};
__game__.stage=__game__.stage||new PIXI.Container;__game__.stage.position.x=~~(.5*game.RESOLUTION_WIDTH);__game__.stage.position.y=~~(.5*game.RESOLUTION_HEIGHT);__game__.stage.addChild(game.world.spriteContainer);__game__.orderedEvents=__game__.orderedEvents||[];
game.Event=function(a){a={timestamp:a&&a.timestamp?a.timestamp:game.timestamp,on_event:a&&a.on_event?a.on_event:function(){}};for(var b=__game__.orderedEvents.length-1;-1<b&&__game__.orderedEvents[b].timestamp>a.timestamp;)--b;__game__.orderedEvents.splice(b+1,0,a);return a};game.InputState=function(a){return{isDown:a&&"undefined"!==typeof a.isDown?a.isDown:!1,lastDown:a&&"undefined"!==typeof a.lastDown?a.lastDown:-99999}};__game__.inputStatesByCode=__game__.inputStatesByCode||{};
game.input=function(a){__game__.inputStatesByCode.hasOwnProperty(a)||(__game__.inputStatesByCode[a]=game.InputState({isDown:!1,lastDown:-99999}));return __game__.inputStatesByCode[a]};game.KEY_ENTER=13;game.KEY_ESC=27;game.KEY_SPACE=32;game.KEY_LEFT=37;game.KEY_UP=38;game.KEY_RIGHT=39;game.KEY_DOWN=40;game.MOUSE_LBUTTON=0;game.MOUSE_MBUTTON=1;game.MOUSE_RBUTTON=2;game.MOUSE_OFFSET=-1;game.read=function(a){(a=localStorage.getItem(a))&&(a=JSON.parse(a));return a};
game.memory=game.memory||game.read("Memory")||{};game.write=function(a,b){return localStorage.setItem(a,JSON.stringify(b))};game.timestamp=game.timestamp||0;game.elapsed=game.elapsed||0;game.update=game.update||function(){};
__game__.update=function(a){requestAnimationFrame(__game__.update);game.elapsed=a-game.timestamp;game.timestamp=a;for(a=__game__.orderedEvents;a.length&&a[a.length-1].timestamp<=game.timestamp;){var b=a.pop();b.on_event(b);if(b.timestamp>game.timestamp){for(var c=a.length-1;-1<c&&a[c].timestamp<b.timestamp;)--c;a.splice(c+1,0,b)}}game.update();for(var d in Entity.byId)d=Entity.byId[d],Entity.update(d);__game__.renderer.render(__game__.stage)};
__game__.keyDown=function(a){__game__.inputStatesByCode.hasOwnProperty(a.keyCode)?__game__.inputStatesByCode[a.keyCode].isDown=!0:__game__.inputStatesByCode[a.keyCode]=game.InputState({isDown:!0})};__game__.keyUp=function(a){__game__.inputStatesByCode.hasOwnProperty(a.keyCode)?(__game__.inputStatesByCode[a.keyCode].isDown=!1,__game__.inputStatesByCode[a.keyCode].lastDown=game.timestamp):__game__.inputStatesByCode[a.keyCode]=game.InputState({lastDown:game.timestamp})};
__game__.mouseMove=function(a){var b=__game__.inputStatesByCode[game.MOUSE_OFFSET];b.x=game.world.offset.x+(a.pageX/innerWidth-.5)*game.RESOLUTION_WIDTH/game.PIXELS_PER_METRE;b.y=game.world.offset.y+(a.pageY/innerHeight-.5)*game.RESOLUTION_HEIGHT/game.PIXELS_PER_METRE};__game__.contextMenu=function(a){a.preventDefault()};__game__.mouseDown=function(a){a.preventDefault();__game__.inputStatesByCode[a.button].isDown=!0};
__game__.mouseUp=function(a){a.preventDefault();__game__.inputStatesByCode[a.button].lastDown=game.timestamp;__game__.inputStatesByCode[a.button].isDown=!1};__game__.resize=function(){game.RESOLUTION_HEIGHT=~~(game.RESOLUTION_WIDTH/(innerWidth/innerHeight));__game__.renderer.resize(game.RESOLUTION_WIDTH,game.RESOLUTION_HEIGHT);__game__.stage.position.x=~~(.5*game.RESOLUTION_WIDTH);__game__.stage.position.y=~~(.5*game.RESOLUTION_HEIGHT)};
__game__.throttledListener=function(a,b){(function(c){window.addEventListener(a,function(a){c||(b(a),c=setTimeout(function(){c=null},66))},!1)})()};
__game__.initialised||(document.body.style.overflow="hidden",document.body.style.margin=document.body.style.padding="0",__game__.inputStatesByCode[game.MOUSE_OFFSET]=src_Vec3__Vec3(),__game__.inputStatesByCode[game.MOUSE_LBUTTON]=game.InputState(),__game__.inputStatesByCode[game.MOUSE_MBUTTON]=game.InputState(),__game__.inputStatesByCode[game.MOUSE_RBUTTON]=game.InputState(),__game__.throttledListener("keydown",__game__.keyDown),__game__.throttledListener("keyup",__game__.keyUp),__game__.throttledListener("mousemove",
__game__.mouseMove),__game__.throttledListener("contextmenu",__game__.contextMenu),__game__.throttledListener("mousedown",__game__.mouseDown),__game__.throttledListener("mouseup",__game__.mouseUp),__game__.throttledListener("resize",__game__.resize),addEventListener("beforeunload",function(){game.write("Memory",game.memory)},!1),__game__.renderer=new PIXI.WebGLRenderer(game.RESOLUTION_WIDTH,game.RESOLUTION_HEIGHT,{transparent:!0}),__game__.renderer.view.style.width="100%",__game__.renderer.view.style.height=
"100%",document.body.appendChild(__game__.renderer.view),requestAnimationFrame(function(a){__game__.update(a)}),"localhost"===location.hostname&&setInterval(function(){var a=new XMLHttpRequest;a.open("GET","/liveupdate");a.onload=function(a){if(200===this.status){a=JSON.parse(this.response);0<a.length&&game.debug("liveupdate");for(var c in a){var d=document.body,e=document.createElement("script");e.src=a[c];var g=document.evaluate('//script[ @src="'+e.src+'" ]',document,null,XPathResult.ANY_TYPE).iterateNext();
g&&(d=g.parentNode,d.removeChild(g));d.appendChild(e)}}};a.send()},2E3),__game__.initialised=!0,game.debug("initialised"));function TreeEntity(a){a=a||{};a.name=a.model="/soba/builds/0.1.0/models/tree";a.offset=a.offset?src_Vec3__Vec3(a.offset):src_Vec3__Vec3();a.size=a.size?src_Vec3__Vec3(a.size):src_Vec3__Vec3({x:3,y:6});a.anchor=src_Vec3__Vec3({x:.54,y:.87});a.collisionBox=src_Vec3__Vec3({x:.25,y:.12});return Entity(a)}
function RockEntity(a){a=a||{};a.name=a.model="/soba/builds/0.2.0/models/rock";a.offset=a.offset?src_Vec3__Vec3(a.offset):src_Vec3__Vec3();a.size=a.size?src_Vec3__Vec3(a.size):src_Vec3__Vec3({x:2,y:2});a.anchor=src_Vec3__Vec3({x:.38,y:.6});a.collisionBox=src_Vec3__Vec3({x:.6,y:.4});return Entity(a)}
function GrassEntity(a){a=a||{};a.name=a.model="/soba/builds/0.1.0/models/grass";a.offset=a.offset?src_Vec3__Vec3(a.offset):src_Vec3__Vec3();a.size=a.size?src_Vec3__Vec3(a.size):src_Vec3__Vec3({x:2,y:1});a.anchor=src_Vec3__Vec3({x:.5,y:.7});return Entity(a)}
function HeroEntity(a){a=a||{};a.name=a.model="/soba/builds/0.1.0/models/troubadour";a.offset=a.offset?src_Vec3__Vec3(a.offset):src_Vec3__Vec3();a.size=a.size?src_Vec3__Vec3(a.size):src_Vec3__Vec3({x:1.2,y:1.8});a.anchor=src_Vec3__Vec3({x:.38,y:.84});a.collisionBox=src_Vec3__Vec3({x:.6,y:.2});a.movement_speed=2;return Entity(a)}
function BaseEntity(a){a=a||{};a.name=a.model="/soba/builds/0.2.0/models/base";a.offset=a.offset?src_Vec3__Vec3(a.offset):src_Vec3__Vec3();a.size=a.size?src_Vec3__Vec3(a.size):src_Vec3__Vec3({x:10,y:10});a.anchor=src_Vec3__Vec3({x:.5,y:.5});return Entity(a)}var __index__=__index__||{};__index__.rightButtonLastDown=__index__.rightButtonLastDown||-99999;__index__.HERO_MOVE_DEADZONE=.15;__index__.HERO_MOVE_TIMEGAP=250;
game.update=function(){path.updateDebugView();var a=game.input(game.MOUSE_LBUTTON),b=game.input(game.MOUSE_RBUTTON);(a.isDown||b.isDown||b.lastDown>__index__.rightButtonLastDown)&&game.timestamp-__index__.rightButtonLastDown>__index__.HERO_MOVE_TIMEGAP&&(__index__.rightButtonLastDown=game.timestamp,a=src_Vec3__Vec3(game.input(game.MOUSE_OFFSET)),src_Vec3__Vec3.distanceToSq(__index__.hero.offset,a)>__index__.HERO_MOVE_DEADZONE&&Entity.move(__index__.hero,a));Entity.update(__index__.hero)};
__index__.base=__index__.base||BaseEntity({offset:src_Vec3__Vec3({x:0,y:0,z:-1}),parent:game.world});__index__.hero=__index__.hero||HeroEntity({offset:src_Vec3__Vec3({x:0,y:0}),parent:game.world});
if(!__index__.trees){__index__.trees=[{x:-7,y:-4,width:3,height:4},{x:-2,y:-5,width:6,height:5},{x:-9,y:-2,width:4,height:5},{x:-8,y:0,width:2,height:4},{x:-4,y:-6,width:4,height:5},{x:1,y:-5.5,width:3,height:5},{x:3,y:-5,width:3,height:5},{x:8,y:-3,width:3,height:5},{x:7,y:0,width:3,height:5},{x:9,y:1,width:3,height:5},{x:2,y:5,width:3,height:5},{x:-1,y:7,width:3,height:5},{x:-3,y:6,width:1,height:2}];for(var tree in __index__.trees)tree=__index__.trees[tree],TreeEntity({offset:src_Vec3__Vec3({x:tree.x,
y:tree.y}),size:src_Vec3__Vec3({x:tree.width,y:tree.height}),parent:game.world});__index__.grasses=[{x:-6,y:-2,width:2,height:1},{x:-9,y:.3,width:3,height:1.5},{x:-6,y:-9,width:2,height:1},{x:.5,y:-4.5,width:2.5,height:2},{x:0,y:4,width:2,height:1},{x:8,y:2,width:2.5,height:1.2},{x:-4,y:6,width:2.5,height:1.2}];for(var grass in __index__.grasses)grass=__index__.grasses[grass],GrassEntity({offset:src_Vec3__Vec3({x:grass.x,y:grass.y}),size:src_Vec3__Vec3({x:grass.width,y:grass.height}),parent:game.world});
__index__.rocks=[{x:-6.5,y:-2.5,width:4,height:2},{x:-8.2,y:-3.1,width:3.5,height:4.5},{x:-10,y:-.7,width:3,height:3},{x:-6,y:-.7,width:1,height:1},{x:-2,y:6.3,width:3,height:1.2},{x:1.9,y:6.9,width:5,height:4},{x:5.5,y:-1,width:1,height:1},{x:6.5,y:-2,width:4,height:3},{x:7.6,y:1.05,width:2.5,height:2.5},{x:10,y:-1.5,width:5,height:5},{x:0,y:-7,width:10,height:6},{x:2,y:-5.8,width:1,height:1},{x:0,y:-5.2,width:3,height:2},{x:-7,y:-9,width:2,height:1}];for(var rock in __index__.rocks)rock=__index__.rocks[rock],
RockEntity({offset:src_Vec3__Vec3({x:rock.x,y:rock.y}),size:src_Vec3__Vec3({x:rock.width,y:rock.height}),parent:game.world});path.initialise()};
		</script>
	</body>
</html>